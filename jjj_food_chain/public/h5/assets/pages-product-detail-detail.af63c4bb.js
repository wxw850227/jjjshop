import{_ as e,z as t,u as s,q as i,o,c as a,w as c,n as r,f as d,a as l,h as u,d as _,t as p,b as n,r as f,F as h,i as m,j as k,A as w}from"./index-61e49878.js";const b=e({components:{},data:()=>({detail:{product_attr:[],product_feed:[],sku:[]},Visible:!1,form:{attr:[],product_sku_id:[],feed:[],detail:{},show_sku:{sku_image:"",bag_price:""},shop_supplier_id:0},stock:0,selectSpec:"",isOpenSpec:!1,type:"",product_price:"",feed_price:0,space_name:"",attr_name:[],feed_name:[],product_lineprice:"",delivery:"",bag_type:1,dinner_type:20,cart_type:0,table_id:0,clock:!1,discount_price:0}),computed:{price:function(){return this.discount_price?((1*this.discount_price+1*this.product_price)*this.form.show_sku.sum).toFixed(2):((1*this.feed_price+1*this.product_price)*this.form.show_sku.sum).toFixed(2)},lineprice:function(){return((1*this.feed_price+1*this.product_lineprice)*this.form.show_sku.sum).toFixed(2)},isadd:function(){return this.form.show_sku.sum>=this.stock||this.form.show_sku.sum>=this.form.detail.limit_num},issub:function(){return this.form.show_sku.sum<=1}},watch:{},onLoad(e){this.product_id=e.product_id,this.delivery=e.delivery,this.bag_type=e.bag_type,this.dinner_type=e.dinner_type,this.cart_type=e.cart_type,this.table_id=e.table_id||0,this.shop_supplier_id=e.shop_supplier_id||0},onShow(){this.clock=!1,this.getData()},methods:{bag_price:function(){return(this.form.show_sku.bag_price*this.form.show_sku.sum).toFixed(2)},goback(){t()},getData(){let e=this;e._get("product.product/detail",{product_id:e.product_id,table_id:e.table_id||0,shop_supplier_id:e.shop_supplier_id||0},(i=>{i.data.detail?(i.data.detail.content=s.format_content(i.data.detail.content),e.detail=i.data.detail,this.showGoodDetailModal()):e.showError("商品已下架",(()=>{t()}))}))},showGoodDetailModal(){let e=this;this.detail.sku.forEach(((e,t)=>{e.checked=!1}));let t={specData:this.detail.sku,detail:this.detail,shop_supplier_id:this.detail.shop_supplier_id,productSpecArr:null!=this.specData?new Array(this.specData.spec_attr.length):[],show_sku:{sku_image:"",seckill_price:0,attr:[],product_sku_id:[],feed:[],line_price:0,seckill_stock:0,seckill_product_sku_id:0,sum:1}};e.form=t,e.space_name="",e.attr_name=[],e.feed_name=[],e.isOpenSpec=!0,e.initShowSku(),0==e.form.detail.sku[0].checked&&e.selecedtSpec(e.form.detail.sku[0],0),""!=e.form.detail.product_attr&&e.form.detail.product_attr.forEach(((t,s)=>{e.form.show_sku.attr[s]||e.selectAttr(t.attribute_value[0],0,s)}))},describe:function(){let e=this.space_name;""!=e&&(e+=";");let t=this.attr_name.join(";");""!=t&&(t+=";");let s=this.feed_name.join(",");return""!=s&&(s+=";"),e+t+s},initShowSku(){this.form.show_sku.sku_image=this.form.detail.product_image,this.form.show_sku.product_price=this.form.detail.product_price,this.form.show_sku.bag_price=this.form.detail.bag_price,this.form.show_sku.product_sku_id=[],this.form.show_sku.attr=[],this.form.show_sku.feed=[],this.form.show_sku.feed.length=this.form.detail.product_feed.length,this.form.show_sku.line_price=this.form.detail.line_price,this.form.show_sku.stock_num=this.form.detail.product_stock,this.form.show_sku.sum=1,this.stock=this.form.detail.product_stock},selecedtSpec(e,t){let s=this;e.checked?(e.checked=!1,s.form.show_sku.product_sku_id[0]=null):(s.form.detail.sku.forEach(((e,t)=>{e.checked=!1})),e.checked=!0,s.form.show_sku.product_sku_id[0]=e.product_sku_id,s.space_name=e.spec_name,s.$set(s.form.show_sku,"product_price",e.product_price),s.$set(s.form.show_sku,"bag_price",e.bag_price),s.$set(s.form.show_sku,"line_price",e.line_price),s.$set(s.form.show_sku,"stock_num",e.stock_num)),null!=s.form.show_sku.product_sku_id[0]?s.updateSpecProduct():s.initShowSku()},selectAttr(e,t,s){let i=this;i.$set(i.form.show_sku.attr,s,t),i.attr_name[s]=e,i.updateSpecProduct()},selectFeed(e,t){let s=this;if(s.form.show_sku.feed[t]||0===s.form.show_sku.feed[t]){s.$set(s.form.show_sku.feed,t,null),s.feed_price-=1*e.price,e.discount_price?s.discount_price-=e.discount_price:s.discount_price-=0;let i=s.feed_name.indexOf(e.feed_name);i>-1&&s.feed_name.splice(i,1)}else s.$set(s.form.show_sku.feed,t,t),s.feed_price+=1*e.price,e.discount_price?s.discount_price+=e.discount_price:s.discount_price+=0,s.feed_name.push(e.feed_name);s.updateSpecProduct()},updateSpecProduct(){this.product_price=this.form.show_sku.product_price,console.log(this.product_lineprice),this.product_lineprice=this.form.show_sku.line_price},add(){this.stock<=0?i({title:"商品库存不足",icon:"none",duration:2e3}):this.form.show_sku.sum++},sub(){if(!(this.stock<=0))return this.form.show_sku.sum<2?(i({title:"商品数量至少为1",icon:"none",duration:2e3}),!1):void this.form.show_sku.sum--},confirmFunc(){if(!this.clock)if(null!=this.form.show_sku.product_sku_id[0]||20!=this.form.detail.spec_type){if(null!=this.form.detail.product_attr)for(let e=0;e<this.form.detail.product_attr.length;e++)if(null==this.form.show_sku.attr[e])return void i({title:"请选择属性",icon:"none",duration:2e3});this.form.show_sku.sum>this.form.show_sku.stock_num?i({title:"商品库存不足",icon:"none",duration:2e3}):this.addCart()}else i({title:"请选择规格",icon:"none",duration:2e3})},addCart(){let e=this,t=[];e.form.show_sku.feed.forEach(((e,s)=>{null!=e&&t.push(e)})),t=t.length<=0?"":t.join(",");let s="";s=e.discount_price?1*e.discount_price+1*e.product_price:1*e.feed_price+1*e.product_price;let i={product_id:e.form.detail.product_id,product_num:e.form.show_sku.sum,product_sku_id:e.form.show_sku.product_sku_id[0],attr:e.form.show_sku.attr.join(","),feed:t,describe:e.describe(),price:s,product_price:1*e.feed_price+1*e.form.show_sku.line_price,bag_price:e.form.show_sku.bag_price,shop_supplier_id:e.form.shop_supplier_id,cart_type:e.cart_type,dinner_type:e.dinner_type,delivery:e.delivery};e.clock=!0,e._post("order.cart/add",i,(function(t){e.clock=!1,history.go(-1)}),(t=>{e.clock=!1}))}}},[["render",function(e,t,s,i,b,g){const y=m,v=d,S=k,C=w;return o(),a(v,{class:r(["good-detail-modal",e.theme()||""]),"data-theme":e.theme()},{default:c((()=>[l(v,{class:"cover"},{default:c((()=>[b.detail.product_image?(o(),a(y,{key:0,src:b.detail.product_image,class:"image",mode:"aspectFill"},null,8,["src"])):u("",!0)])),_:1}),l(v,{class:"bg-white"},{default:c((()=>[l(v,{class:"good_basic"},{default:c((()=>[l(v,{class:"name text-ellipsis"},{default:c((()=>[_(p(b.detail.product_name||""),1)])),_:1}),l(v,{class:"f22 gray9"},{default:c((()=>[_("已售"+p(b.detail.product_sales||""),1)])),_:1}),l(v,{class:"gray6 sell-point",style:{"line-height":"1.5"}},{default:c((()=>[_(p(b.detail.selling_point||""),1)])),_:1})])),_:1})])),_:1}),l(v,{class:"detail bg-white"},{default:c((()=>[l(v,{class:"wrapper"},{default:c((()=>[l(v,{class:"properties"},{default:c((()=>[20==b.detail.spec_type?(o(),a(v,{key:0,class:"property"},{default:c((()=>[l(v,{class:"title"},{default:c((()=>[l(S,{class:"name"},{default:c((()=>[_("规格")])),_:1})])),_:1}),l(v,{class:"values"},{default:c((()=>[(o(!0),n(h,null,f(b.detail.sku,((e,t)=>(o(),a(v,{class:r(["value",{default:e.checked}]),onClick:s=>g.selecedtSpec(e,t),key:t},{default:c((()=>[_(p(e.spec_name),1)])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})):u("",!0),b.detail.product_attr.length>0?(o(!0),n(h,{key:1},f(b.detail.product_attr,((t,s)=>(o(),a(v,{class:"property",key:s},{default:c((()=>[l(v,{class:"title"},{default:c((()=>[l(S,{class:"name"},{default:c((()=>[_(p(t.attribute_name||""),1)])),_:2},1024)])),_:2},1024),l(v,{class:"values"},{default:c((()=>[""!=e.value?(o(!0),n(h,{key:0},f(t.attribute_value,((e,t)=>(o(),a(v,{class:r(["value",{default:b.form.show_sku.attr[s]==t}]),onClick:i=>g.selectAttr(e,t,s),key:t},{default:c((()=>[_(p(e),1)])),_:2},1032,["onClick","class"])))),128)):u("",!0)])),_:2},1024)])),_:2},1024)))),128)):u("",!0),b.detail.product_feed.length>0?(o(),a(v,{key:2,class:"property"},{default:c((()=>[l(v,{class:"title"},{default:c((()=>[l(S,{class:"name"},{default:c((()=>[_("加料")])),_:1})])),_:1}),l(v,{class:"values"},{default:c((()=>[(o(!0),n(h,null,f(b.detail.product_feed,((e,t)=>(o(),a(v,{class:r(["value",{default:null!=b.form.show_sku.feed[t]}]),onClick:s=>g.selectFeed(e,t),key:t},{default:c((()=>[_(" +"+p(e.feed_name),1)])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})):u("",!0)])),_:1})])),_:1})])),_:1}),l(v,{class:"spec-bottom"},{default:c((()=>[l(v,{class:"action"},{default:c((()=>[l(v,{class:"d-c d-a-s"},{default:c((()=>[l(v,{class:"left mb10"},{default:c((()=>[l(v,{class:"price"},{default:c((()=>[l(S,{class:"f22 fb"},{default:c((()=>[_("￥")])),_:1}),l(S,{class:"f36 fb mr12"},{default:c((()=>[_(p(g.price),1)])),_:1}),l(S,{class:"f24 gray9 text-l-t mr10"},{default:c((()=>[_("￥"+p(g.lineprice),1)])),_:1}),1!=b.bag_type?(o(),a(S,{key:0},{default:c((()=>[l(S,{class:"f22 gray9"},{default:c((()=>[_("打包费￥"+p(g.bag_price()),1)])),_:1})])),_:1})):u("",!0)])),_:1})])),_:1}),l(v,{class:"f22 gray9"},{default:c((()=>[_(p(g.describe()),1)])),_:1})])),_:1}),l(v,{class:"btn-group"},{default:c((()=>[l(C,{type:"default",plain:"",class:"btn theme-borderbtn",size:"min","hover-class":"none",onClick:t[0]||(t[0]=e=>g.sub())},{default:c((()=>[l(v,{class:"icon icon-jian iconfont iconsami-select"})])),_:1}),l(v,{class:"number"},{default:c((()=>[_(p(b.form.show_sku.sum),1)])),_:1}),l(C,{type:"primary",class:"btn theme-btn",size:"min","hover-class":"none",onClick:t[1]||(t[1]=e=>g.add())},{default:c((()=>[l(v,{class:"icon icon-jia iconfont iconadd-select"})])),_:1})])),_:1})])),_:1}),l(v,null,{default:c((()=>[l(v,{class:"add-to-cart-btn",onClick:g.confirmFunc},{default:c((()=>[l(v,null,{default:c((()=>[_("加入购物车")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),l(v,{class:"product-content"},{default:c((()=>[l(v,{class:"border-b-e"},{default:c((()=>[l(v,{class:"group-hd d-s-c"},{default:c((()=>[l(S,{class:"min-name pr f30 fb"},{default:c((()=>[_("详情")])),_:1})])),_:1})])),_:1}),l(v,{class:"content-box",innerHTML:b.detail.content},null,8,["innerHTML"])])),_:1})])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-9b103e33"]]);export{b as default};
