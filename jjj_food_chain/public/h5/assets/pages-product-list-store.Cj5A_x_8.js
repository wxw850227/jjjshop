import{_ as t,u as e,l as a,a7 as l,a3 as i,a5 as s,p as r,k as c,m as d,E as o,D as _,v as p,j as n,c as u,w as y,d as f,e as h,o as g,a as k,h as m,t as b,b as C,r as v,F as T,g as w,n as L,J as I,z as S,i as x,C as P,B as D}from"./index-g5-6g3i5.js";import{_ as z,p as H,a as M,b as V}from"./loading.BZ65y7cx.js";import{r as F}from"./uni-app.es.JON5rhdf.js";const j=t({components:{popupLayer:z,prospec:H},data:()=>({loadingClock:!1,isSearch:!1,isLogin:!1,isDetail:!1,isLoading:!0,goods:[],supplier:{name:"",business_status:0},loading:!0,currentCateId:0,cateScrollTop:0,menuScrollIntoView:"",cart:[],category:{},cartPopupVisible:!1,sizeCalcState:!1,listData:[],productList:[],productModel:{},clock:!1,cart_total_num:0,cart_product_id:0,total_price:0,total_bag_price:0,cart_list:[],orderType:"takein",takeout_address:{},phoneHeight:0,scrollviewHigh:0,delivery_time:["00:00","00:00"],store_time:["00:00","00:00"],officeTime:{now:0,delivery_start:0,delivery_end:0,store_start:0,store_end:0},addclock:!1,longitude:0,latitude:0,bag_type:1,shop_supplier_id:0,dinner_type:30,cart_type:1,table_id:0,order_id:0,addorder_id:0,discountInfo:[],reduce:{},reduce_diff_value:0,line_price:0,isFirst:!0,store_set:[],num:1,table_detail:null,options:{},settle_type:0,status:"",meal_num:"",isShopDetail:!1,supplierDetail:null}),onLoad(t){let i=this,s=e.getSceneData(t);i.options=t,i.shop_supplier_id=t.shop_supplier_id?t.shop_supplier_id:s.sid,i.table_id=t.table_id?t.table_id:s.tid,i.table_id||(i.table_id=0),0==i.table_id&&(i.shop_supplier_id=a("selectedId")?a("selectedId"):0),i.num=t.num||0,i.meal_num=t.meal_num||0,i.status=t.status,i.addorder_id=t.order_id||0,l({title:0==i.table_id?"快餐模式":"堂食点餐"})},onShow(){this.isDetail=!1,this.getUserInfo()},computed:{menuCartNum(){return t=>this.cart.reduce(((e,a)=>a.cate_id===t?e+a.number:e),0)}},methods:{getUserInfo(){let t=this;t.loading=!0,t.isLogin=!1,t._get("index/userInfo",{},(function(e){e.data&&e.data.user&&(t.isLogin=!0),t.init()}))},init(){this.addclock=!1,this.category={},this.clock=!1,this.loading=!0,this.isLoading=!0,this.productList=[],this.sizeCalcState=!1,this.getCategory(!0)},goBack(){this.table_id>0&&1==this.status||history.go(-1)},scrollInit(){let t=this;i({success(e){t.phoneHeight=e.windowHeight,s().select(".nav").boundingClientRect((e=>{let a=t.phoneHeight-e.height;t.scrollviewHigh=a})).exec()}})},takout(){"takeout"!=this.orderType&&(this.orderType="takeout",this.dinner_type=10,this.init())},takein(){"takein"!=this.orderType&&(this.orderType="takein",this.dinner_type=20,this.init())},getCategory(t){let e=this;this.sizeCalcState=!1,e._get("product.category/index",{type:1,shop_supplier_id:e.shop_supplier_id,longitude:0,latitude:0,table_id:e.table_id,delivery:"takeout"==e.orderType?30:40,order_type:0==e.table_id?1:2,cart_type:e.cart_type||1},(function(a){e.supplier=a.data.supplier,e.discountInfo=a.data.discountInfo,e.productList=a.data.list,e.currentCateId||(e.currentCateId=e.productList[0].category_id),e.store_set=a.data.supplier.store_set,0!=e.table_id&&(e.orderType="takein"),e.shop_supplier_id=a.data.supplier.shop_supplier_id,e.bag_type=a.data.supplier.storebag_type,"takein"==e.orderType&&(e.bag_type=1),e.loading=!1,e.isLoading=!1,e.$nextTick((function(){e.scrollInit()})),e.isLogin&&t&&e.getCart()}),(function(){e.gotoPage("/pages/index/index")}))},reCart(t){let e=this;e.loadingClock=!1,e.cart_total_num=t.data.cartInfo.cart_total_num,e.total_price=t.data.cartInfo.total_pay_price,e.line_price=t.data.cartInfo.total_line_money,e.total_bag_price=t.data.cartInfo.total_bag_price,e.reduce=t.data.cartInfo.reduce,e.reduce_diff_value=t.data.cartInfo.reduce_diff_value,e.cart_list&&""!=e.cart_list||(e.cartPopupVisible=!1)},addCart(t){let e=this;if(20==t.spec_types)return void e.gotoDetail(t);if(e.addclock)return;if(0!=t.limit_num&&t.limit_num<=t.cart_num)return void r({icon:"none",title:"超过限购数量"});if(t.product_stock<=0||t.product_stock<=t.cart_num)return void r({icon:"none",title:"没有更多库存了"});let a={product_id:t.product_id,product_num:1,product_sku_id:t.sku[0].product_sku_id,attr:"",feed:"",describe:"",price:t.sku[0].product_price,bag_price:t.sku[0].bag_price,shop_supplier_id:e.shop_supplier_id,table_id:e.table_id,cart_type:1,dinner_type:e.dinner_type,product_price:t.sku[0].line_price,delivery:"takeout"==e.orderType?30:40};e.addclock=!0;c({title:"",mask:!0}),e._post("order.cart/add",a,(function(t){e.reCart(t),d(),e.addclock=!1,e.getCategory(!1)}),(function(t){d(),e.addclock=!1}))},reduceFunc(t){let e=this;if(e.addclock||t.cart_num<=0)return;if(20==t.spec_types)return void e.openCartPopup(t.product_id);let a=t.product_id;e.addclock=!0;c({title:"",mask:!0}),e._post("order.cart/productSub",{product_id:a,type:"down",cart_type:1,shop_supplier_id:e.shop_supplier_id,table_id:e.table_id,dinner_type:e.dinner_type,delivery:"takeout"==e.orderType?30:40},(function(t){d(),e.reCart(t),e.addclock=!1,e.getCategory(!1)}),(function(){d(),e.addclock=!1}))},getCartLoading(){let t=this,e={shop_supplier_id:t.shop_supplier_id,cart_type:1,delivery:"takeout"==t.orderType?30:40,product_id:t.cart_product_id,table_id:t.table_id||0};t._get("order.cart/lists",e,(function(e){!function(e){d(),t.isLoading=!0,t.reCart(e),t.cart_list=e.data.productList}(e)}),(t=>{d()}))},getCart(){let t=this;if(t.isLogin)return new Promise(((e,a)=>{let l={shop_supplier_id:t.shop_supplier_id,cart_type:1,delivery:"takeout"==t.orderType?30:40,product_id:t.cart_product_id,table_id:t.table_id||0};c({title:"",mask:!0}),t._get("order.cart/lists",l,(function(a){!function(e){d(),t.isLoading=!0,t.reCart(e),t.cart_list=e.data.productList}(a),e(!0)}),(t=>{d()}))}))},cartAdd(t){let e=this;if(e.addclock)return;e.addclock=!0;let a=t.product_id;c({title:"",mask:!0}),e._post("order.cart/sub",{product_id:a,total_num:1,cart_id:t.cart_id,type:"up",cart_type:1,delivery:"takeout"==e.orderType?30:40,dinner_type:e.dinner_type,shop_supplier_id:e.shop_supplier_id,table_id:e.table_id},(function(t){e.addclock=!1,e.getCategory(!1),e.getCartLoading()}),(function(){d(),e.addclock=!1}))},cartReduce(t){let e=this;if(e.addclock)return;e.addclock=!0;let a=t.product_id;c({title:"",mask:!0}),e._post("order.cart/sub",{product_id:a,total_num:1,cart_id:t.cart_id,type:"down",cart_type:1,dinner_type:e.dinner_type,shop_supplier_id:e.shop_supplier_id,table_id:e.table_id,delivery:"takeout"==e.orderType?30:40},(function(t){e.addclock=!1,e.getCategory(!1),e.getCartLoading()}),(function(){d(),e.addclock=!1}))},handleCartClear(){let t=this;o({title:"提示",content:"确定清空购物车么",success(e){e.confirm?t.clearCart():e.cancel&&console.log("用户点击取消")}})},clearCart(){let t=this,e={shop_supplier_id:t.shop_supplier_id,cart_type:1,table_id:t.table_id||0};t._post("order.cart/delete",e,(function(e){t.cartPopupVisible=!1,t.cart_list=[],t.init()}))},toPay(){this.fastToPay()},fastToPay(){let t=this;t.loadingClock=!0,c({title:"加载中",mask:!0});let e="takeout"==t.orderType?30:40;t._get("order.cart/lists",{shop_supplier_id:t.shop_supplier_id,cart_type:1,delivery:e,table_id:t.table_id||0},(function(a){t.reCart(a),t.cart_list=a.data.productList;let l=[];if(t.cart_list.forEach((t=>{l.push(t.cart_id)})),0==l.length)return r({title:"请选择商品",icon:"none"}),!1;d(),_({url:"/pages/order/confirm-order?order_type=cart&cart_ids="+l.join(",")+"&delivery="+e+"&shop_supplier_id="+t.shop_supplier_id+"&cart_type=1&dinner_type=30&table_id="+t.table_id})}),(e=>{t.loadingClock=!1}))},addpay(){c({title:"加载中",mask:!0}),this.addpayFunc()},addpayFunc(){let t=this;t._get("order.cart/lists",{shop_supplier_id:t.shop_supplier_id,cart_type:1,delivery:"takeout"==t.orderType?30:40,table_id:t.table_id||0},(function(e){t.cart_total_num=e.data.cartInfo.cart_total_num,t.total_price=e.data.cartInfo.total_price,t.cart_list=e.data.productList;let a=[];if(t.cart_list.forEach((t=>{a.push(t.cart_id)})),0==a.length)return r({title:"请选择商品",icon:"none"}),!1;d();let l="/pages/order/addorder?order_type=cart&cart_ids="+a.join(",")+"&delivery=40&shop_supplier_id="+t.shop_supplier_id+"&cart_type=1&dinner_type=30&table_id="+t.table_id+"&order_id="+t.addorder_id;t.gotoPage(l)}))},gotoDetail(t){let e=this,a="takeout"==e.orderType?30:40;e.productModel={product_id:t.product_id||0,delivery:a,bag_type:e.bag_type||0,dinner_type:e.dinner_type||0,cart_type:e.cart_type||0,table_id:e.table_id||0,shop_supplier_id:e.shop_supplier_id||0},e.isDetail=!0},handleMenuTap(t){let e=this;e.sizeCalcState||e.calcSize(),e.currentCateId=t,e.$nextTick((()=>{e.cateScrollTop=e.productList.find((e=>e.category_id==t)).top,e.cateScrollTop||0==e.cateScrollTop||setTimeout((function(){e.handleMenuTap(t)}),200)}))},handleGoodsScroll({detail:t}){this.sizeCalcState||this.calcSize();const{scrollTop:e}=t;let a=this.productList.filter((t=>t.top-5<=e)).reverse();a.length>0&&(this.currentCateId=a[0].category_id)},calcSize(){let t=0;this.productList.forEach((e=>{s().select(`#cate-${e.category_id}`).fields({size:!0},(a=>{e.top=t,null!=a&&(t+=a.height),e.bottom=t})).exec()})),this.sizeCalcState=!0},closeGoodDetailModal(t,e){this.isDetail=!1,this.clock=!1,t&&(this.reCart(e),this.getCategory(!1))},async openCartPopup(t){this.cartPopupVisible||(this.cart_list=[],this.cart_product_id=t,await this.getCart()),this.cartPopupVisible=!this.cartPopupVisible},closeCallBack(){this.cart_product_id=0,this.cart_list=[],this.cartPopupVisible=!1}}},[["render",function(t,e,a,l,i,s){const r=S,c=h,d=x,o=P,_=D,H=F(p("popup-layer"),z),j=n("prospec");return g(),u(c,{class:f(["container",t.theme()||""]),"data-theme":t.theme()},{default:y((()=>[k(c,{class:"main"},{default:y((()=>[k(c,{class:"nav"},{default:y((()=>[k(c,{class:f(["header",{tableHead:0!=i.table_id&&i.table_detail}])},{default:y((()=>[k(c,{class:"left"},{default:y((()=>[k(c,{class:"store-name"},{default:y((()=>[k(r,{class:"fb"},{default:y((()=>[m(b(i.supplier.name),1)])),_:1})])),_:1})])),_:1}),0==i.table_id?(g(),u(c,{key:0,class:"dinner-right"},{default:y((()=>[(g(!0),C(T,null,v(i.store_set,((t,e)=>(g(),C(T,{key:t},["30"==t?(g(),u(c,{key:0,class:f(["dinner_type",{active:"takeout"==i.orderType}]),onClick:s.takout},{default:y((()=>[k(r,null,{default:y((()=>[m("打包")])),_:1})])),_:1},8,["class","onClick"])):w("",!0)],64)))),128)),(g(!0),C(T,null,v(i.store_set,((t,e)=>(g(),C(T,{key:t},["40"==t?(g(),u(c,{key:0,class:f(["dinner_type",{active:"takein"==i.orderType}]),onClick:s.takein},{default:y((()=>[k(r,null,{default:y((()=>[m("店内")])),_:1})])),_:1},8,["class","onClick"])):w("",!0)],64)))),128))])),_:1})):w("",!0)])),_:1},8,["class"])])),_:1}),k(c,{class:"content"},{default:y((()=>[k(o,{class:"menus",style:L("height:"+i.scrollviewHigh+"px;"),"scroll-into-view":i.menuScrollIntoView,"scroll-with-animation":!0,"scroll-animation-duration":1,"scroll-y":""},{default:y((()=>[k(c,{class:"category-wrapper"},{default:y((()=>[(g(!0),C(T,null,v(i.productList,((t,e)=>(g(),C(T,{key:e},[0!=t.products.length?(g(),u(c,{key:0,class:f(["menu d-s-c",{current:t.category_id===i.currentCateId}]),id:`menu-${t.category_id}`,onClick:e=>s.handleMenuTap(t.category_id)},{default:y((()=>[t.images?(g(),u(d,{key:0,src:t.images.file_path,mode:"aspectFill",class:"f-s-0 menu-imgs"},null,8,["src"])):w("",!0),k(r,null,{default:y((()=>[m(b(t.name),1)])),_:2},1024),t.product_num?(g(),u(c,{key:1,class:"menu-cartNum"},{default:y((()=>[m(b(t.product_num),1)])),_:2},1024)):w("",!0)])),_:2},1032,["id","class","onClick"])):w("",!0)],64)))),128)),k(c,{class:"menu-bottom"})])),_:1})])),_:1},8,["style","scroll-into-view"]),k(o,{class:"goods pr",style:L("height:"+i.scrollviewHigh+"px;"),"scroll-y":"","scroll-top":i.cateScrollTop,onScroll:s.handleGoodsScroll},{default:y((()=>[k(c,{class:"goods-wrapper"},{default:y((()=>[k(c,{class:"list",style:L("padding-bottom:"+(2*i.scrollviewHigh-238)+"rpx;")},{default:y((()=>[(g(!0),C(T,null,v(i.productList,((e,a)=>(g(),C(T,{key:a},[0!=e.products.length?(g(),u(c,{key:0,class:"category",id:`cate-${e.category_id}`},{default:y((()=>[k(c,{class:"title"},{default:y((()=>[k(r,null,{default:y((()=>[m(b(e.name),1)])),_:2},1024)])),_:2},1024),k(c,{class:"goods-items"},{default:y((()=>[(g(!0),C(T,null,v(e.products,((e,a)=>(g(),u(c,{class:"good",onClick:t=>s.gotoDetail(e),key:a},{default:y((()=>[k(c,{class:"image-boxs"},{default:y((()=>[e.product_stock<=0?(g(),u(c,{key:0,class:"sallsell-out"},{default:y((()=>[k(c,{class:"sallsell-out-btn"},{default:y((()=>[m("当前售罄")])),_:1})])),_:1})):w("",!0),k(d,{src:e.product_image,class:"image"},null,8,["src"])])),_:2},1024),k(c,{class:"product-info"},{default:y((()=>[k(c,{class:"ww100"},{default:y((()=>[k(c,{class:"name text-ellipsis"},{default:y((()=>[m(b(e.product_name),1)])),_:2},1024),k(c,{class:"tips text-ellipsis"},{default:y((()=>[m(b(e.selling_point),1)])),_:2},1024)])),_:2},1024),k(c,{class:"price_and_action"},{default:y((()=>[k(c,null,{default:y((()=>[k(r,{class:"f24 theme-price"},{default:y((()=>[m("￥")])),_:1}),k(r,{class:"f34 theme-price"},{default:y((()=>[m(b(e.product_price),1)])),_:2},1024),1*e.product_price!=1*e.line_price?(g(),u(r,{key:0,class:"linprice"},{default:y((()=>[m("￥"+b(1*e.line_price),1)])),_:2},1024)):w("",!0)])),_:2},1024),k(c,{class:"btn-group"},{default:y((()=>[0!=e.cart_num?(g(),u(d,{key:0,onClick:I((t=>s.reduceFunc(e)),["stop"]),class:"add-image",src:"/static/icon/cart/reduce-"+t.theme()+".png",mode:""},null,8,["onClick","src"])):w("",!0),0!=e.cart_num?(g(),u(c,{key:1,class:"number"},{default:y((()=>[m(b(e.cart_num),1)])),_:2},1024)):w("",!0),e.product_stock>0?(g(),u(d,{key:2,onClick:I((t=>s.addCart(e)),["stop"]),class:"add-image",src:"/static/icon/cart/add-"+t.theme()+".png",mode:""},null,8,["onClick","src"])):w("",!0),e.product_stock<=0?(g(),u(d,{key:3,class:"add-image",src:V,mode:""})):w("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:2},1024)])),_:2},1032,["id"])):w("",!0)],64)))),128))])),_:1},8,["style"])])),_:1})])),_:1},8,["style","scroll-top","onScroll"])])),_:1}),k(c,{class:"cart-box",onClick:e[0]||(e[0]=I((t=>s.openCartPopup(0)),["stop"]))},{default:y((()=>[k(c,{class:"mark"},{default:y((()=>[k(c,{class:"icon iconfont icon-gouwudai cart-view"}),i.cart_total_num?(g(),u(c,{key:0,class:"tag"},{default:y((()=>[m(b(i.cart_total_num),1)])),_:1})):w("",!0)])),_:1}),i.cart_total_num?(g(),u(c,{key:0,class:"price"},{default:y((()=>[k(c,null,{default:y((()=>[k(r,{class:"f22"},{default:y((()=>[m("￥")])),_:1}),k(r,{class:"f36"},{default:y((()=>[m(b(i.total_price),1)])),_:1}),k(r,{class:"gray9 f22 text-d-line fn ml10"},{default:y((()=>[m("￥"+b(i.line_price),1)])),_:1})])),_:1})])),_:1})):(g(),u(c,{key:1,class:"flex-1 f32 white"},{default:y((()=>[m("未选购商品")])),_:1})),0!=i.table_id?(g(),u(_,{key:2,class:"pay-btn",onClick:I(s.toPay,["stop"])},{default:y((()=>[k(r,null,{default:y((()=>[m("下单")])),_:1})])),_:1},8,["onClick"])):(g(),C(T,{key:3},[0==i.addorder_id?(g(),u(_,{key:0,class:"pay-btn",onClick:I(s.toPay,["stop"])},{default:y((()=>[k(r,null,{default:y((()=>[m("去结算")])),_:1})])),_:1},8,["onClick"])):w("",!0)],64))])),_:1})])),_:1}),i.cart_total_num>0?(g(),u(H,{key:0,direction:"top","show-pop":i.cartPopupVisible,class:"cart-popup",onCloseCallBack:s.closeCallBack},{content:y((()=>[k(c,{class:"cart-popup pr"},{default:y((()=>[k(c,{class:"top d-b-c"},{default:y((()=>[k(c,{class:"f30 gray3 d-s-c"},{default:y((()=>[m(" 购物车 "),i.total_bag_price?(g(),u(c,{key:0,class:"f22 gray3"},{default:y((()=>[m("（打包费 "),k(r,{class:"theme-price"},{default:y((()=>[m("￥"+b(i.total_bag_price),1)])),_:1}),m("）")])),_:1})):w("",!0)])),_:1}),k(c,{onClick:s.handleCartClear,class:"d-c-c"},{default:y((()=>[k(r,{class:"icon iconfont icon-shanchu1"}),m("清空购物车")])),_:1},8,["onClick"])])),_:1}),k(o,{class:"cart-list","scroll-y":""},{default:y((()=>[k(c,{class:"wrapper"},{default:y((()=>[(g(!0),C(T,null,v(i.cart_list,((e,a)=>(g(),C(T,{key:a},[e.product_num>0?(g(),u(c,{key:0,class:"item"},{default:y((()=>[k(c,{class:"d-s-c ww100"},{default:y((()=>[k(c,{class:"cart-image"},{default:y((()=>[k(d,{style:{},src:e.image.file_path,mode:"aspectFill"},null,8,["src"])])),_:2},1024),k(c,{class:"left"},{default:y((()=>[k(c,null,{default:y((()=>[k(c,{class:"name text-ellipsis"},{default:y((()=>[m(b(e.product.product_name),1)])),_:2},1024),k(c,{class:"gray9"},{default:y((()=>[m(b(e.describe),1)])),_:2},1024)])),_:2},1024),k(c,{class:"center"},{default:y((()=>[k(r,null,{default:y((()=>[m("￥")])),_:1}),k(r,{class:"f34"},{default:y((()=>[m(b(e.price),1)])),_:2},1024),1!=i.bag_type?(g(),u(r,{key:0,class:"f24 gray9 ml10"},{default:y((()=>[m("包装费￥"+b(e.bag_price),1)])),_:2},1024)):w("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024),k(c,{class:"right"},{default:y((()=>[k(d,{onClick:t=>s.cartReduce(e),class:"btn-image",src:"/static/icon/cart/reduce-"+t.theme()+".png",mode:""},null,8,["onClick","src"]),k(c,{class:"number"},{default:y((()=>[m(b(e.product_num),1)])),_:2},1024),k(d,{onClick:t=>s.cartAdd(e),class:"btn-image",src:"/static/icon/cart/add-"+t.theme()+".png",mode:""},null,8,["onClick","src"])])),_:2},1024)])),_:2},1024)):w("",!0)],64)))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["show-pop","onCloseCallBack"])):w("",!0),i.isDetail?(g(),u(j,{key:1,productModel:i.productModel,onClose:s.closeGoodDetailModal},null,8,["productModel","onClose"])):w("",!0),i.loading?(g(),u(c,{key:2,class:"loading"},{default:y((()=>[k(d,{src:M})])),_:1})):w("",!0)])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-0fc63e1d"]]);export{j as default};
