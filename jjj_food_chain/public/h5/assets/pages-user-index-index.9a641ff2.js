import{_ as e,s as a,H as t,q as s,l as i,p as l,m as n,J as o,o as d,c,w as u,n as r,f as p,a as g,d as f,t as m,h,b as _,r as k,F as v,i as b,j as y,I as C,A as P,K as U,k as w}from"./index-61e49878.js";import{U as x}from"./upload.a6979ced.js";const I=e({components:{Upload:x},data:()=>({isloadding:!0,sign:{},loadding:!0,indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,menus:[],detail:{balance:0,grade:{name:""},mobile:""},orderCount:{},setting:{},card_detail:null,sessionKey:"",urldata:"",isPopup:!1,avatarUrl:"",nickName:"",imageList:[],isUpload:!1}),onPullDownRefresh(){this.getData()},onLoad(e){this.isWeixin()&&(this.urldata=window.location.href),e.invitation_id&&a("invitation_id",e.invitation_id),e.referee_id&&a("referee_id",e.referee_id)},onShow(){this.getData()},methods:{changeAvatarUrl(){this.isUpload=!0},changeInfo(){this.avatarUrl=this.detail.avatarUrl,this.nickName=this.detail.nickName,this.isPopup=!0},getData(){let e=this;e.isloadding=!0,e._get("user.index/detail",{url:e.urldata},(function(a){e.detail=a.data.userInfo,e.sign=a.data.sign,e.menus=a.data.menus,e.setting=a.data.setting,e.loadding=!1,e.card_detail=a.data.cardDetail,t(),e.isloadding=!1,""!=e.urldata&&(e.jweixin=e.configWxScan(a.data.signPackage))}))},bindMobile(){this.gotoPage("/pages/user/modify-phone/modify-phone")},jumpPage(e){let a=this;a.isloadding||(e.startsWith("/")?a.gotoPage(e):a[e]())},toinvitation(e){0==e?s({title:"暂无活动"}):this.gotoPage("/pages/user/invite/invite?invitation_gift_id="+e)},scanQrcode:function(){this.gotoPage("/pages/user/scan/scan")},receipt:function(){let e=this;this.isWeixin()?e.jweixin.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(e){window.location.href=e.resultStr},error:function(e){s({title:"扫码失败，请重试"})}}):console.log("H5暂只支持公众号扫码")},getQr(e){for(var a=e.substring(e.indexOf("?")+1).split("&"),t=[],s=0;s<a.length;s++){var i=a[s].split("=");i.length<2?t[i[0]]="":t[i[0]]=i[1]}return"/pages/order/group/receipt?scene="+t.scene},getPhoneNumber(e){var a=this;if("getPhoneNumber:ok"!==e.detail.errMsg)return!1;i({title:"加载中"}),a._post("user.user/bindMobile",{session_key:a.sessionKey,encrypted_data:e.detail.encryptedData,iv:e.detail.iv},(e=>{s({title:"绑定成功"}),a.getData()}),!1,(()=>{l()}))},copyFunc(e){var a=document.createElement("input");a.value=e,document.body.appendChild(a),a.select(),a.setSelectionRange(0,a.value.length),document.execCommand("Copy"),document.body.removeChild(a),s({title:"复制成功",icon:"success",mask:!0,duration:2e3})},onChooseAvatar(e){console.log(e),this.uploadFile([e.detail.avatarUrl])},uploadFile:function(e){let a=this;a.imageList=[];let t=0,s=e.length,d={token:n("token"),app_id:a.getAppId()};i({title:"图片上传中"}),e.forEach((function(e,i){o({url:a.websiteUrl+"/index.php?s=/api/file.upload/image",filePath:e,name:"iFile",formData:d,success:function(e){let t="object"==typeof e.data?e.data:JSON.parse(e.data);1===t.code?a.imageList.push(t.data):a.showError(t.msg)},complete:function(){t++,s===t&&(l(),a.getImgsFunc(a.imageList))}})}))},getImgsFunc(e){if(e&&void 0!==e){let a=this;a.avatarUrl=e[0].file_path,a.isUpload=!1}},changeinput(e){this.nickName=e.target.value},closeFunc(e){this.isPopup=!1},subName(e){let a=this;if(a.loading)return;i({title:"加载中"});let t={avatarUrl:a.avatarUrl,nickName:e.detail.value.nickName};a.loading=!0,a._post("user.user/updateInfo",t,(function(e){a.showSuccess("修改成功",(function(){a.loading=!1,a.isPopup=!1,l(),a.getData()}),(function(e){l(),a.loading=!1,a.isPopup=!1}))}))}}},[["render",function(e,a,t,s,i,l){const n=b,o=p,x=y,I=C,F=P,N=U,D=w("Upload");return d(),c(o,{class:r(["user-index pb60",e.theme()||""]),"data-theme":e.theme()},{default:u((()=>[i.loadding?h("",!0):(d(),c(o,{key:0},{default:u((()=>[g(o,{class:"user-header pr theme-bg"},{default:u((()=>[g(o,{class:"user-header-inner"},{default:u((()=>[g(o,{class:"user-info"},{default:u((()=>[g(o,{class:"photo",onClick:l.changeInfo},{default:u((()=>[g(n,{src:i.detail.avatarUrl,mode:"aspectFill"},null,8,["src"])])),_:1},8,["onClick"]),g(o,{class:"info d-c d-c-s"},{default:u((()=>[g(o,{class:"d-c-c"},{default:u((()=>[g(o,{class:"name"},{default:u((()=>[f(m(i.detail.nickName),1)])),_:1}),i.detail.grade?(d(),c(x,{key:0,class:"ml10"},{default:u((()=>[f(m(i.detail.grade.name),1)])),_:1})):h("",!0)])),_:1}),g(o,{class:"tel d-s-c"},{default:u((()=>[g(x,{class:"f26"},{default:u((()=>[f("用户ID:"+m(i.detail.user_id),1)])),_:1}),g(x,{class:"copy-btn",onClick:a[0]||(a[0]=e=>l.copyFunc(i.detail.user_id+""))},{default:u((()=>[f("复制")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),g(o,{class:"my-order"},{default:u((()=>[g(o,{class:"order-top"},{default:u((()=>[g(o,{class:"order-title"},{default:u((()=>[f("我的订单")])),_:1}),g(o,{class:"order-all",onClick:a[1]||(a[1]=a=>e.gotoPage("/pages/order/myorder"))},{default:u((()=>[f("全部订单"),g(x,{class:"icon iconfont icon-jiantou"})])),_:1})])),_:1}),g(o,{class:"list d-a-c flex-1"},{default:u((()=>[g(o,{class:"item d-c-c d-c",onClick:a[2]||(a[2]=a=>e.gotoPage("/pages/user/my-wallet/my-wallet"))},{default:u((()=>[g(o,{class:"red_mini"},{default:u((()=>[f(m(i.detail.balance),1)])),_:1}),g(x,{class:"pt16 f28 gray3"},{default:u((()=>[f("金额"),g(x,{class:"f22 gray9"},{default:u((()=>[f("(元)")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),g(o,{class:"menu-wrap"},{default:u((()=>[g(o,{class:"order-top"},{default:u((()=>[g(o,{class:"order-title"},{default:u((()=>[f("服务功能")])),_:1})])),_:1}),g(o,{class:"group-bd f-w"},{default:u((()=>[(d(!0),_(v,null,k(i.menus,((e,a)=>(d(),_(v,{key:a},[1==e.status?(d(),c(o,{key:0,class:"item",onClick:a=>l.jumpPage(e.link_url)},{default:u((()=>[g(o,{class:"icon-round d-c-c"},{default:u((()=>[g(n,{class:"icon-round",src:e.image_url,mode:"aspectFit"},null,8,["src"])])),_:2},1024),g(x,{class:"name"},{default:u((()=>[f(m(e.title),1)])),_:2},1024)])),_:2},1032,["onClick"])):h("",!0)],64)))),128))])),_:1})])),_:1})])),_:1})),i.isPopup?(d(),_(v,{key:1},[g(o,{class:"pop-bg",onClick:a[3]||(a[3]=e=>l.closeFunc(null))}),g(o,{class:"pop-input d-c d-c-c"},{default:u((()=>[g(N,{onSubmit:l.subName},{default:u((()=>[g(o,{class:"ww100 flex-1 pop-top"},{default:u((()=>[g(x,{class:"icon iconfont icon-guanbi",onClick:a[4]||(a[4]=e=>l.closeFunc(null))}),g(o,{class:"pop-title tc"},{default:u((()=>[f("资料修改")])),_:1}),g(o,{class:"d-c-c",style:{"margin-bottom":"30rpx"}},{default:u((()=>[g(o,{class:"info-image"},{default:u((()=>[g(o,{class:"d-e-c",onClick:l.changeAvatarUrl},{default:u((()=>[g(n,{src:i.avatarUrl||"/static/login-log.jpg",mode:""},null,8,["src"])])),_:1},8,["onClick"])])),_:1})])),_:1}),g(o,{class:"input-box d-c-c"},{default:u((()=>[f(" 昵称 "),g(I,{type:"nickname",name:"nickName",value:i.nickName,onInput:l.changeinput},null,8,["value","onInput"])])),_:1})])),_:1}),g(F,{class:"d-c-c pop-btn theme-btn","form-type":"submit"},{default:u((()=>[f("确认")])),_:1})])),_:1},8,["onSubmit"])])),_:1})],64)):h("",!0),i.isUpload?(d(),c(D,{key:2,num:1,onGetImgs:l.getImgsFunc},null,8,["onGetImgs"])):h("",!0)])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-7e7b2bbc"]]);export{I as default};
