import{_ as e,l as i,x as t,p as s,k as a,s as o,y as n,m as l,c as d,w as c,d as g,e as r,o as u,a as _,h as f,t as p,i as h,z as m}from"./index-g5-6g3i5.js";const k=e({data:()=>({wx_phone:!1,loading:!0,background:"",listData:[],invitation_id:0,user_id:"",mobile:!0,isRead:!1,setting:{login_desc:"",login_logo:"",name:""}}),onShow(){},onLoad(e){this.invitation_id=i("invitation_id")||0;let s=this;this.getCodeType(),uni.getUserInfo({success:function(e){const a=e.userInfo;console.log(a),t({provider:"weixin",success:e=>{console.log("res-login",e),s.code=e.code,"login:ok"==e.errMsg&&(s.code,a.nickName,a.avatarUrl,s._post("user.user/login",{code:s.code,source:"wx",invitation_id:s.invitation_id,referee_id:i("referee_id")},(e=>{s.user_id=e.data.user_id,s.mobile=e.data.mobile}),!1,(()=>{s.loading=!1})))}})}})},methods:{xieyi(e){this.gotoPage("/pages/webview/ue?type="+e)},getCodeType(){let e=this;e._post("index/loginSetting",{},(i=>{e.setting=i.data.setting,e.wx_phone=i.data.setting.wx_phone}))},onNotLogin:function(){this.gotoPage("/pages/index/index")},UserLogin(){let e=this;e.loading||(e.isRead?(a({title:"正在处理",mask:!0}),t({success(i){let t={code:i.code};e._post("user.user/userLogin",t,(e=>{o("token",e.data.token),o("user_id",e.data.user_id),n()}),!1,(()=>{l()}))}})):s({title:"请勾选并同意《隐私政策》和《用户协议》",icon:"none"}))},getUserInfo:function(e){let i=this;if(!i.loading)if(i.isRead){if("getPhoneNumber:ok"!==e.detail.errMsg)return!1;a({title:"正在处理",mask:!0}),t({success(t){let s={code:t.code,user_id:i.user_id,encrypted_data:e.detail.encryptedData,iv:e.detail.iv};i._post("user.user/bindMobile",s,(e=>{o("token",e.data.token),o("user_id",e.data.user_id),n()}),!1,(()=>{l()}))}})}else s({title:"请勾选并同意《隐私政策》和《用户协议》",icon:"none"})},onGetAuthorize(e){console.log("开始授权");let i=this;t({provider:"alipay",success:function(e){console.log("sucss"),uni.getUserInfo({provider:"alipay",success:function(t){i.aliPayLogin(e,t)}})},fail(e){console.log(e)}})},aliPayLogin(e,i){let t=this;console.log(e),console.log(i),a({title:"登录中",mask:!0}),t._post("user.useralipay/login",{code:e.code,avatar:i.avatar,nickName:i.nickName},(e=>{console.log(e.data.token),o("token",e.data.token),o("user_id",e.data.user_id),t.gotoPage("/pages/index/index","redirect")}),!1,(()=>{t.gotoPage("/pages/index/index","redirect")}))}}},[["render",function(e,i,t,s,a,o){const n=h,l=r,k=m;return u(),d(l,{class:g(["login-container",e.theme()||""]),"data-theme":e.theme()},{default:c((()=>[_(l,{class:"wechatapp"},{default:c((()=>[_(n,{class:"logo-image",src:a.setting.login_logo||"/static/login-default.png"},null,8,["src"]),_(l,{class:"d-c-c f30 gray3"},{default:c((()=>[f(p(a.setting.name),1)])),_:1})])),_:1}),_(l,{class:"auth-title fb"},{default:c((()=>[f(p(a.setting.login_desc),1)])),_:1}),_(l,{class:"auth-subtitle"},{default:c((()=>[f("授权绑定手机号 为您提供更好的服务")])),_:1}),_(l,{class:"login-btn d-c-c"}),_(l,{onClick:i[2]||(i[2]=e=>a.isRead=!a.isRead),class:"d-c-c gray6 mt20"},{default:c((()=>[_(l,{class:g(["icon iconfont icon-tijiaochenggong",a.isRead?"active agreement":"agreement"])},null,8,["class"]),f(" 我已阅读并接受"),_(k,{class:"theme-notice",onClick:i[0]||(i[0]=e=>o.xieyi("service"))},{default:c((()=>[f("《用户协议》")])),_:1}),f("和"),_(k,{class:"theme-notice",onClick:i[1]||(i[1]=e=>o.xieyi("privacy"))},{default:c((()=>[f("《隐私政策》")])),_:1})])),_:1}),_(l,{class:"no-login-btn d-c d-c-c"},{default:c((()=>[_(l,{class:"f26 gray9",onClick:o.onNotLogin},{default:c((()=>[f("暂不登录")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-9c82d5f4"]]);export{k as default};
