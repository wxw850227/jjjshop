import{_ as e,Y as a,l as t,k as s,Z as o,m as l,o as n,c as i,e as d,$ as u,M as c,j as r,w as p,d as f,a as m,h as g,t as h,g as _,i as I,z as b,I as k}from"./index-g5-6g3i5.js";import{P as y}from"./uni-popup.D_CVBUk_.js";/* empty css                                                                  */const U=e({components:{Popup:y,Upload:e({data:()=>({imageList:[]}),onLoad(){},mounted(){this.chooseImageFunc()},methods:{chooseImageFunc(){let e=this;a({count:9,sizeType:["original","compressed"],sourceType:["album"],success:function(a){e.uploadFile(a.tempFilePaths)},fail:function(a){e.$emit("getImgs",null)},complete:function(e){}})},uploadFile:function(e){let a=this,n=0,i=e.length,d={token:t("token"),app_id:a.getAppId()};s({title:"上传中"}),e.forEach((function(e,t){o({url:a.websiteUrl+"/index.php?s=/api/file.upload/image",filePath:e,name:"iFile",formData:d,header:{appId:a.getAppId()},success:function(e){let t="object"==typeof e.data?e.data:JSON.parse(e.data);1===t.code&&a.imageList.push(t.data)},complete:function(){n++,i===n&&(l(),a.$emit("getImgs",a.imageList))}})}))}}},[["render",function(e,a,t,s,o,l){const u=d;return n(),i(u)}]])},data:()=>({userInfo:{},isBirthday:!1,birthday:"",imageList:[],newName:"",type:"",isUpload:!1,mobileModel:{mobile:"",code:""},passwordModel:{mobile:"",code:"",password:"",repassword:""},isPhone:!1,isPassword:!1,sms_open:!1}),onShow(){this.getData()},methods:{clearStorage(){u()},maskPhone:e=>e&&11===e.length?e.replace(/(\d{3})\d{4}(\d{4})/,"$1***$2"):e,onChooseAvatar(e){this.uploadFile([e.detail.avatarUrl])},getData(){let e=this;s({title:"加载中",mask:!0}),e._get("user.index/setting",{},(function(a){e.userInfo=a.data.userInfo,l()}))},changeAvatarUrl(){this.isUpload=!0},uploadFile:function(e){let a=this;a.imageList=[];let n=0,i=e.length,d={token:t("token"),app_id:a.getAppId()};s({title:"图片上传中",mask:!0}),e.forEach((function(e,t){o({url:a.websiteUrl+"/index.php?s=/api/file.upload/image",filePath:e,name:"iFile",formData:d,success:function(e){let t="object"==typeof e.data?e.data:JSON.parse(e.data);1===t.code?a.imageList.push(t.data):a.showError(t.msg)},complete:function(){n++,i===n&&(l(),a.getImgsFunc(a.imageList))}})}))},getImgsFunc(e){if(e&&void 0!==e){let a=this;a.userInfo.avatarUrl=e[0].file_path,a.update(),a.isUpload=!1}},logout(){let e=this;e._post("/user.User/logOut",{},(a=>{c("token"),c("user_id"),e.gotoPage("/pages/index/index")}))},update(){let e=this;if(e.loading)return;s({title:"加载中",mask:!0});let a=e.userInfo;e.loading=!0,e._post("user.user/updateInfo",a,(function(a){e.showSuccess("修改成功",(function(){e.loading=!1,l(),e.getData()}),(function(a){l(),e.loading=!1}))}))}}},[["render",function(e,a,t,s,o,l){const u=I,c=d,y=b,U=k,x=r("Upload");return n(),i(c,{class:f(["address-form o-h",e.theme()||""]),"data-theme":e.theme()},{default:p((()=>[m(c,{class:"avatar-box"},{default:p((()=>[m(c,{class:"info-image",onClick:l.changeAvatarUrl},{default:p((()=>[m(u,{class:"ava-image",src:o.userInfo.avatarUrl||"/static/default.png",mode:""},null,8,["src"]),m(c,{class:"icon iconfont icon-shangchuantupian_f"})])),_:1},8,["onClick"])])),_:1}),m(c,{class:"user-info bg-white f26"},{default:p((()=>[m(c,{class:"d-b-c"},{default:p((()=>[m(y,{class:"key-name"},{default:p((()=>[g("会员ID")])),_:1}),m(c,{class:"userinfo-text border-b"},{default:p((()=>[g(h(o.userInfo.user_id),1)])),_:1})])),_:1}),m(c,{class:"d-b-c"},{default:p((()=>[m(y,{class:"key-name"},{default:p((()=>[g("昵称")])),_:1}),m(U,{class:"userinfo-input border-b",placeholder:"请输入昵称","placeholder-class":"gray9",type:"text",modelValue:o.userInfo.nickName,"onUpdate:modelValue":a[0]||(a[0]=e=>o.userInfo.nickName=e)},null,8,["modelValue"])])),_:1}),m(c,{class:"d-b-c"},{default:p((()=>[m(y,{class:"key-name"},{default:p((()=>[g("手机")])),_:1}),m(c,{class:"d-s-c border-b flex-1"},{default:p((()=>[m(y,{class:"userinfo-text"},{default:p((()=>[g(h(l.maskPhone(o.userInfo.mobile)),1)])),_:1})])),_:1})])),_:1})])),_:1}),m(c,{class:"sub-btn theme-btn",onClick:l.update},{default:p((()=>[g("保存")])),_:1},8,["onClick"]),m(c,{class:"setup-btn",onClick:a[1]||(a[1]=e=>l.logout())},{default:p((()=>[g("退出登录")])),_:1}),o.isUpload?(n(),i(x,{key:0,num:1,onGetImgs:l.getImgsFunc},null,8,["onGetImgs"])):_("",!0)])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-729aa8d8"]]);export{U as default};
