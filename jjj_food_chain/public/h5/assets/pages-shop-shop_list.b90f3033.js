import{_ as t,m as e,L as s,l as o,s as a,p as l,v as i,q as n,T as d,o as c,c as r,w as u,n as g,f as _,a as f,b as h,r as p,F as m,d as y,g as w,j as L,k,C as b,t as x,N as S}from"./index-61e49878.js";import{u as v}from"./uni-load-more.aa58dc35.js";const D=t({components:{uniLoadMore:v},data:()=>({distance:"",loading:!0,storeList:[],longitude:"",latitude:"",selectedId:{region:{city:"",store_id:-1,distance_unit:"",log:{file_path:""}},store_name:""},store_name:"",list_rows:10,last_page:0,page:1,no_more:!1,scrollviewHigh:0,longitude:"",latitude:"",selectedId:""}),computed:{loadingType(){return this.loading?1:0!=this.storeList.length&&this.no_more?2:0}},onLoad(t){},onShow(){this.restoreData(),this.getcityData()},mounted(){this.selectedId=e("selectedId"),this.init()},methods:{init(){let t=this;s({success(e){t.scrollviewHigh=e.windowHeight}})},restoreData(){this.storeList=[],this.search="",this.no_more=!1,this.page=1},scrolltolowerFunc(){let t=this;if(t.bottomRefresh=!0,t.page++,t.loading=!0,t.page>t.last_page)return t.loading=!1,void(t.no_more=!0);t.getData()},getcityData(){let t=this;if(t.isWeixin()){let s=e("sign");s?t.getWxLocation(s):(o({title:"加载中"}),t._post("index/index",{url:window.location.href},(function(e){a("sign",e.data.signPackage),s=e.data.signPackage,l(),t.getWxLocation(s)})))}else t.getLocation()},onAuthorize(){let t=this;uni.openSetting({success(e){e.authSetting["scope.userLocation"]&&(t.isAuthor=!0,setTimeout((()=>{t.getLocation((t=>{}))}),1e3))}})},getLocation(t){let e=this;i({type:"wgs84",success(t){e.longitude=t.longitude,e.latitude=t.latitude,e.getData()},fail(t){e.getData(),n({title:"获取定位失败，请点击右下角按钮打开定位权限",duration:2e3,icon:"none"})}})},getWxLocation(t,e){let s=this;var o=require("jweixin-module");o.config(JSON.parse(t)),o.ready((function(t){o.getLocation({type:"wgs84",success:function(t){s.longitude=t.longitude,s.latitude=t.latitude,s.getData()},fail(t){s.getData()}})})),o.error((function(t){console.log(t)}))},getData(){let t=this;t.loading=!0,o({title:"加载中"}),t._get("supplier.index/list",{longitude:t.longitude||0,latitude:t.latitude||0},(function(e){l(),t.loading=!1,t.storeList=t.storeList.concat(e.data.list.data),t.last_page=e.data.list.last_page,e.data.list.last_page<=1&&(t.no_more=!0)}))},chooseLocation(){let t=this;d({success:function(e){console.log("位置名称："+e.name),console.log("详细地址："+e.address),console.log("纬度："+e.latitude),console.log("经度："+e.longitude),t.longitude=e.longitude,t.latitude=e.latitude,t.getrecord(),t.getData()}})},search(){let t=this;t.loading=!0,t._get("store.store/lists",{store_name:t.store_name,longitude:t.longitude,latitude:t.latitude},(function(e){t.loading=!1,t.storeList=e.data.list}))},onSelectedStore(t,e){this.selectedId=t,a("selectedId",this.selectedId),e&&history.go(-1)},getrecord(){let t=this,e=t.selectedId.store_id;t._post("user.storelog/record",{store_id:e,longitude:t.longitude,latitude:t.latitude},(function(e){t.distance=e.data.detail.distance_unit}))},addSotre(t){let e=t.store_id;this._post("user.storelog/add",{store_id:e},(function(t){}))},isShopid:t=>e("selectedId")==t}},[["render",function(t,e,s,o,a,l){const i=_,n=L,d=k("uni-load-more"),v=b;return c(),r(i,{"data-theme":t.theme(),class:g(t.theme()||"")},{default:u((()=>[f(v,{"scroll-y":"true",class:"scroll-Y",style:w("height:"+a.scrollviewHigh+"px;"),"lower-threshold":"50",onScrolltolower:l.scrolltolowerFunc},{default:u((()=>[f(i,{class:"address-list"},{default:u((()=>[(c(!0),h(m,null,p(a.storeList,((e,s)=>(c(),r(i,{class:g(["address pt26 p-0-26 bg-white",l.isShopid(e.shop_supplier_id)?"active":""]),onClick:t=>l.onSelectedStore(e.shop_supplier_id),key:s},{default:u((()=>[f(i,{class:"info flex-1"},{default:u((()=>[f(i,{class:"user f34 d-b-c"},{default:u((()=>[f(i,{class:"d-s-c"},{default:u((()=>[f(i,{class:g(e.shop_supplier_id!=a.selectedId?"select-id":"select-id icon iconfont icon-tijiaochenggong")},null,8,["class"]),f(i,{class:"f32 fb gray3"},{default:u((()=>[y(x(e.name),1)])),_:2},1024)])),_:2},1024),f(i,{class:"distance"},{default:u((()=>[f(n,null,{default:u((()=>[y("距离:"+x(e.distance),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),f(i,{class:"d-b-c"},{default:u((()=>[f(i,{class:"text-ellipsis f22 gray6"},{default:u((()=>[y(x(e.address),1)])),_:2},1024),f(i,{class:"text-ellipsis f22 gray6"},{default:u((()=>[f(n,{class:"icon iconfont icon-time",style:{color:"#333333","font-size":"22rpx","margin-right":"15rpx"}}),e.delivery_time.length>0?(c(),r(n,{key:0},{default:u((()=>[y(x(e.delivery_time[0]+"-"+e.delivery_time[1]),1)])),_:2},1024)):(c(),r(n,{key:1},{default:u((()=>[y("24小时")])),_:1}))])),_:2},1024)])),_:2},1024),f(i,{class:"mt16 mb30 d-b-c"},{default:u((()=>[f(i),f(i,null,{default:u((()=>[0==e.status?(c(),r(n,{key:0,class:"shop_status theme-borderbtn"},{default:u((()=>[y("营业中")])),_:1})):(c(),r(n,{key:1,class:"shop_status theme-borderbtn"},{default:u((()=>[y("暂停营业")])),_:1}))])),_:2},1024)])),_:2},1024)])),_:2},1024),f(i,{class:"info-right d-b-c"},{default:u((()=>[f(i,{class:"d-s-c gray3"},{default:u((()=>[f(i,{class:"d-s-c",onClick:S((s=>t.callPhone(e.link_phone)),["stop"])},{default:u((()=>[f(i,{class:"icon iconfont icon-002dianhua"}),f(n,{class:"f26 fb ml18"},{default:u((()=>[y("咨询服务方")])),_:1})])),_:2},1032,["onClick"]),f(i,{class:"ml25 d-s-c",onClick:S((s=>t.openmap(e.latitude,e.longitude)),["stop"])},{default:u((()=>[f(i,{class:"icon iconfont icon-fasong"}),f(n,{class:"f26 fb ml18"},{default:u((()=>[y("导航去这里")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),f(i,{class:"f26 gray3 theme-btn",onClick:S((t=>l.onSelectedStore(e.shop_supplier_id,!0)),["stop"])},{default:u((()=>[y("去下单 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["onClick","class"])))),128)),0!=a.storeList.length||a.loading?(c(),r(d,{key:1,loadingType:l.loadingType},null,8,["loadingType"])):(c(),r(i,{key:0,class:"d-c-c p30"},{default:u((()=>[f(n,{class:"iconfont icon-wushuju"}),f(n,{class:"cont"},{default:u((()=>[y("亲，暂无相关记录哦")])),_:1})])),_:1}))])),_:1})])),_:1},8,["style","onScrolltolower"])])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-00e083d6"]]);export{D as default};
