import{_ as e,L as s,q as l,l as t,s as o,m as a,a4 as d,p as i,E as n,o as r,c as u,w as c,g as p,f as _,a as f,d as g,t as m,h as b,n as w,j as h,I as x,A as y}from"./index-61e49878.js";const k=e({data:()=>({formData:{mobile:"",code:""},loging_password:"",register:{mobile:"",password:"",repassword:"",code:""},resetpassword:{mobile:"",password:"",repassword:"",code:""},is_send:!1,send_btn_txt:"获取验证码",second:60,ip:"",isShow:!0,is_login:1,is_code:!1,phoneHeight:0}),onShow(){this.init()},methods:{init(){let e=this;s({success(s){e.phoneHeight=s.windowHeight}})},formSubmit(){let e=this,s={mobile:e.formData.mobile},n="";if(/^1(3|4|5|6|7|8|9)\d{9}$/.test(e.formData.mobile)){if(e.is_code){if(""==e.formData.code)return void l({title:"验证码不能为空！",duration:2e3,icon:"none"});s.code=e.formData.code,n="user.useropen/smslogin"}else{if(""==e.loging_password)return void l({title:"密码不能为空！",duration:2e3,icon:"none"});s.password=e.loging_password,n="user.useropen/phonelogin"}t({title:"正在提交"}),e._post(n,s,(e=>{o("token",e.data.token),o("user_id",e.data.user_id);let s=a("currentPage"),l=a("currentPageOptions");if(Object.keys(l).length>0){s+="?";for(let e in l)s+=e+"="+l[e]+"&";s=s.substring(0,s.length-1)}d(s)}),!1,(()=>{i()}))}else l({title:"手机有误,请重填！",duration:2e3,icon:"none"})},registerSub(){let e=this;/^1(3|4|5|6|7|8|9)\d{9}$/.test(e.register.mobile)?""!=e.register.code?e.register.password.length<6?l({title:"密码至少6位数！",duration:2e3,icon:"none"}):e.register.password===e.register.repassword?(e.register.invitation_id=a("invitation_id")||0,e.register.referee_id=a("referee_id")||0,t({title:"正在提交"}),e._post("user.useropen/register",e.register,(s=>{l({title:"注册成功",duration:3e3}),e.formData.mobile=e.register.mobile,e.register={mobile:"",password:"",repassword:"",code:""},e.second=0,e.changeMsg(),e.is_login=1}),!1,(()=>{i()}))):l({title:"两次密码输入不一致！",duration:2e3,icon:"none"}):l({title:"验证码不能为空！",duration:2e3,icon:"none"}):l({title:"手机有误,请重填！",duration:2e3,icon:"none"})},resetpasswordSub(){let e=this;/^1(3|4|5|6|7|8|9)\d{9}$/.test(e.resetpassword.mobile)?""!=e.resetpassword.code?e.resetpassword.password.length<6?l({title:"密码至少6位数！",duration:2e3,icon:"none"}):e.resetpassword.password===e.resetpassword.repassword?(t({title:"正在提交"}),e._post("user.useropen/resetpassword",e.resetpassword,(s=>{l({title:"重置成功",duration:3e3}),e.formData.mobile=e.resetpassword.mobile,e.resetpassword={mobile:"",password:"",repassword:"",code:""},e.second=0,e.changeMsg(),e.is_login=1}),!1,(()=>{i()}))):l({title:"两次密码输入不一致！",duration:2e3,icon:"none"}):l({title:"验证码不能为空！",duration:2e3,icon:"none"}):l({title:"手机有误,请重填！",duration:2e3,icon:"none"})},isCode(){this.is_code?this.$set(this,"is_code",!1):this.$set(this,"is_code",!0)},sendCode(){let e=this;if(1==e.is_login){if(!/^1(3|4|5|6|7|8|9)\d{9}$/.test(e.formData.mobile))return void l({title:"手机有误,请重填！",duration:2e3,icon:"none"})}else if(2==e.is_login){if(!/^1(3|4|5|6|7|8|9)\d{9}$/.test(e.register.mobile))return void l({title:"手机有误,请重填！",duration:2e3,icon:"none"})}else if(0==e.is_login&&!/^1(3|4|5|6|7|8|9)\d{9}$/.test(e.resetpassword.mobile))return void l({title:"手机有误,请重填！",duration:2e3,icon:"none"});let s="register",t=e.register.mobile;1==e.is_login?(s="login",t=e.formData.mobile):0==e.is_login&&(s="login",t=e.resetpassword.mobile),e._post("user.useropen/sendCode",{mobile:t,type:s},(s=>{1==s.code&&(l({title:"发送成功"}),e.is_send=!0,e.changeMsg())}))},login(){let e=this;plus.oauth.getServices((function(s){let l=s[0];l.authResult?console.log("已经登陆认证"):l.authorize((function(s){t({title:"登录中",mask:!0}),e._post("user.useropen/login",{code:s.code,source:"app"},(e=>{o("token",e.data.token),o("user_id",e.data.user_id);let s=a("currentPage"),l=a("currentPageOptions");if(Object.keys(l).length>0){s+="?";for(let e in l)s+=e+"="+l[e]+"&";s=s.substring(0,s.length-1)}console.log("url = "+s),d(s)}),!1,(()=>{i()}))}),(function(e){console.log("登陆认证失败!"),n({title:"认证失败1",content:JSON.stringify(e)})}))}),(function(e){console.log("获取服务列表失败："+JSON.stringify(e))}))},changeMsg(){this.second>0?(this.send_btn_txt=this.second+"秒",this.second--,setTimeout(this.changeMsg,1e3)):(this.send_btn_txt="获取验证码",this.second=60,this.is_send=!1)}}},[["render",function(e,s,l,t,o,a){const d=_,i=h,n=x,k=y;return r(),u(d,{class:"login-container",style:p("height: "+o.phoneHeight+"px;")},{default:c((()=>[2==o.is_login?(r(),u(d,{key:0,class:"p-30-75"},{default:c((()=>[f(d,{class:"login_topbpx"},{default:c((()=>[f(d,{class:"login_tit"},{default:c((()=>[g("注册")])),_:1}),f(d,{class:"login_top"},{default:c((()=>[g("已有账户，"),f(i,{class:"red",onClick:s[0]||(s[0]=e=>o.is_login=1)},{default:c((()=>[g("立即登录")])),_:1})])),_:1})])),_:1}),f(d,{class:"group-bd"},{default:c((()=>[f(d,{class:"form-level d-s-c"},{default:c((()=>[f(d,{class:"val flex-1 input_botom"},{default:c((()=>[f(n,{type:"text",modelValue:o.register.mobile,"onUpdate:modelValue":s[1]||(s[1]=e=>o.register.mobile=e),placeholder:"请填写手机号",disabled:o.is_send},null,8,["modelValue","disabled"])])),_:1})])),_:1}),f(d,{class:"form-level d-s-c"},{default:c((()=>[f(d,{class:"val flex-1 input_botom"},{default:c((()=>[f(n,{type:"text",password:"true",modelValue:o.register.password,"onUpdate:modelValue":s[2]||(s[2]=e=>o.register.password=e),placeholder:"请输入密码"},null,8,["modelValue"])])),_:1})])),_:1}),f(d,{class:"form-level d-s-c"},{default:c((()=>[f(d,{class:"val flex-1 input_botom"},{default:c((()=>[f(n,{type:"text",password:"true",modelValue:o.register.repassword,"onUpdate:modelValue":s[3]||(s[3]=e=>o.register.repassword=e),placeholder:"请确认密码"},null,8,["modelValue"])])),_:1})])),_:1}),f(d,{class:"form-level d-s-c"},{default:c((()=>[f(d,{class:"val flex-1 d-b-c input_botom"},{default:c((()=>[f(n,{class:"flex-1",type:"number",modelValue:o.register.code,"onUpdate:modelValue":s[4]||(s[4]=e=>o.register.code=e),placeholder:"请填写验证码"},null,8,["modelValue"]),f(k,{class:"get-code-btn",type:"default",onClick:a.sendCode,disabled:o.is_send},{default:c((()=>[g(m(o.send_btn_txt),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1})])),_:1})):b("",!0),1==o.is_login?(r(),u(d,{key:1,class:"p-30-75"},{default:c((()=>[f(d,{class:"login_topbpx"},{default:c((()=>[f(d,{class:"login_tit"},{default:c((()=>[g("登录")])),_:1}),f(d,{class:"login_top"},{default:c((()=>[g("还没有账号，"),f(i,{class:"red",onClick:s[5]||(s[5]=e=>o.is_login=2)},{default:c((()=>[g("立即注册")])),_:1})])),_:1})])),_:1}),f(d,{class:"group-bd"},{default:c((()=>[f(d,{class:"form-level d-s-c"},{default:c((()=>[f(d,{class:"val flex-1 input_botom"},{default:c((()=>[f(n,{type:"text",modelValue:o.formData.mobile,"onUpdate:modelValue":s[6]||(s[6]=e=>o.formData.mobile=e),placeholder:"请填写手机号"},null,8,["modelValue"])])),_:1})])),_:1}),o.is_code?b("",!0):(r(),u(d,{key:0,class:"form-level d-s-c"},{default:c((()=>[f(d,{class:"val flex-1 input_botom"},{default:c((()=>[f(n,{type:"text",password:"true",modelValue:o.loging_password,"onUpdate:modelValue":s[7]||(s[7]=e=>o.loging_password=e),placeholder:"请输入密码"},null,8,["modelValue"])])),_:1})])),_:1})),o.is_code?(r(),u(d,{key:1,class:"form-level d-s-c"},{default:c((()=>[f(d,{class:"val flex-1 d-b-c input_botom"},{default:c((()=>[f(n,{class:"flex-1",type:"number",modelValue:o.formData.code,"onUpdate:modelValue":s[8]||(s[8]=e=>o.formData.code=e),placeholder:"请填写验证码"},null,8,["modelValue"]),f(k,{class:"get-code-btn",type:"default",onClick:a.sendCode,disabled:o.is_send},{default:c((()=>[g(m(o.send_btn_txt),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})):b("",!0)])),_:1})])),_:1})):b("",!0),0==o.is_login?(r(),u(d,{key:2,class:"p-30-75"},{default:c((()=>[f(d,{class:"login_topbpx"},{default:c((()=>[f(d,{class:"login_tit"},{default:c((()=>[g("重置密码")])),_:1}),f(d,{class:"login_top"},{default:c((()=>[f(i,{class:"red",onClick:s[9]||(s[9]=e=>o.is_login=1)},{default:c((()=>[g("立即登录")])),_:1})])),_:1})])),_:1}),f(d,{class:"group-bd"},{default:c((()=>[f(d,{class:"form-level d-s-c"},{default:c((()=>[f(d,{class:"val flex-1 input_botom"},{default:c((()=>[f(n,{type:"text",modelValue:o.resetpassword.mobile,"onUpdate:modelValue":s[10]||(s[10]=e=>o.resetpassword.mobile=e),placeholder:"请填写手机号",disabled:o.is_send},null,8,["modelValue","disabled"])])),_:1})])),_:1}),f(d,{class:"form-level d-s-c"},{default:c((()=>[f(d,{class:"val flex-1 input_botom"},{default:c((()=>[f(n,{type:"text",password:"true",modelValue:o.resetpassword.password,"onUpdate:modelValue":s[11]||(s[11]=e=>o.resetpassword.password=e),placeholder:"请输入密码"},null,8,["modelValue"])])),_:1})])),_:1}),f(d,{class:"form-level d-s-c"},{default:c((()=>[f(d,{class:"val flex-1 input_botom"},{default:c((()=>[f(n,{type:"text",password:"true",modelValue:o.resetpassword.repassword,"onUpdate:modelValue":s[12]||(s[12]=e=>o.resetpassword.repassword=e),placeholder:"请确认密码"},null,8,["modelValue"])])),_:1})])),_:1}),f(d,{class:"form-level d-s-c"},{default:c((()=>[f(d,{class:"val flex-1 d-b-c input_botom"},{default:c((()=>[f(n,{class:"flex-1",type:"number",modelValue:o.resetpassword.code,"onUpdate:modelValue":s[13]||(s[13]=e=>o.resetpassword.code=e),placeholder:"请填写验证码"},null,8,["modelValue"]),f(k,{class:"get-code-btn",type:"default",onClick:a.sendCode,disabled:o.is_send},{default:c((()=>[g(m(o.send_btn_txt),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1})])),_:1})):b("",!0),1==o.is_login?(r(),u(d,{key:3,class:w(["gray6 p-0-75",o.is_code?"d-e-c":"d-b-c"])},{default:c((()=>[o.is_code?b("",!0):(r(),u(d,{key:0,onClick:s[14]||(s[14]=e=>o.is_login=0)},{default:c((()=>[g("忘记密码?")])),_:1})),f(d,{onClick:s[15]||(s[15]=e=>a.isCode())},{default:c((()=>[g(m(o.is_code?"使用密码登录":"使用验证码登录"),1)])),_:1})])),_:1},8,["class"])):b("",!0),2==o.is_login?(r(),u(d,{key:4,style:{"padding-top":"80rpx"},class:"btns p-30-75"},{default:c((()=>[f(k,{type:"default",onClick:a.registerSub},{default:c((()=>[g("注册")])),_:1},8,["onClick"])])),_:1})):b("",!0),1==o.is_login?(r(),u(d,{key:5,style:{"padding-top":"80rpx"},class:"btns p-30-75"},{default:c((()=>[f(k,{type:"default",onClick:a.formSubmit},{default:c((()=>[g("登录")])),_:1},8,["onClick"])])),_:1})):b("",!0),0==o.is_login?(r(),u(d,{key:6,style:{"padding-top":"80rpx"},class:"btns p-30-75"},{default:c((()=>[f(k,{type:"default",onClick:a.resetpasswordSub},{default:c((()=>[g("重置密码")])),_:1},8,["onClick"])])),_:1})):b("",!0),1==o.is_login?(r(),u(d,{key:7,class:"bottom_nav"},{default:c((()=>[f(d,{class:"bottom-box"},{default:c((()=>[f(d,{class:"other_tit"},{default:c((()=>[f(i,{class:"bg-white p-0-20"},{default:c((()=>[g("其他方式登录")])),_:1})])),_:1}),f(d,{class:"pt30 d-c-c"},{default:c((()=>[f(d,{class:"weixin_box",onClick:a.login},{default:c((()=>[f(i,{class:"icon iconfont icon-weixin"})])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):b("",!0)])),_:1},8,["style"])}],["__scopeId","data-v-4ab34fdc"]]);export{k as default};
