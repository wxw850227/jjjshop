import{f as e,b as a,c as l,o,l as t,a as r,d as i,j as d,e as s,k as p,p as n,v as m,m as u,q as c}from"./element-plus-d2381bb9.js";import{r as h}from"./request-9782e391.js";import{_ as f,d as g}from"./index-ea3b29b4.js";import{o as _,S as b,R as w,a as V,O as y,V as C,_ as x,c as v,X as D,ad as k}from"./@vue-5f6096d8.js";import"./@vueuse-40ae03aa.js";import"./lodash-es-493ac664.js";import"./async-validator-cf877c1f.js";import"./dayjs-03c8ce7e.js";import"./call-bind-224993cc.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-e5d54f4f.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./axios-85bcd05e.js";import"./qs-bc70bccf.js";import"./side-channel-f1de7f2e.js";import"./object-inspect-02d150af.js";import"./vue-router-0438cf31.js";import"./pinia-a7eba4b6.js";import"./vue-demi-71ba0ef2.js";let j={shopList:(e,a)=>h._post("/admin/shop/index",e,a),addShop:(e,a)=>h._post("/admin/shop/add",e,a),editShop:(e,a)=>h._post("/admin/shop/edit",e,a),updateStatus:(e,a)=>h._post("/admin/shop/updateStatus",e,a),storeEnter:(e,a)=>h._post("/admin/shop/enter",e,a),deleteShop:(e,a)=>h._post("/admin/shop/delete",e,a),updateWxStatus:(e,a)=>h._post("/admin/shop/updateWxStatus",e,a),updateChain:(e,a)=>h._post("/admin/shop/updateChain",e,a)};const S={data(){return{form:{no_expire:!1},formLabelWidth:"120px",dialogVisible:!1,loading:!1,rules:{app_name:[{validator:(e,a,l)=>a?this.$filter.isAllSpace(a)?l(new Error("不能全是空格")):void l():l(new Error("请输入平台名称")),required:!0,trigger:"blur"}],user_name:[{validator:(e,a,l)=>this.$filter.replaceSpace(a)?this.$filter.hasSpace(a)?l(new Error("不能包含空格")):void l():l(new Error("平台账户名")),required:!0,trigger:"blur"}],password:[{validator:(e,a,l)=>{if(a){if(this.$filter.hasSpace(a))return l(new Error("不能包含空格"));if(a.length<6)return l(new Error("长度不能小于6位"));l()}else l()},trigger:"change"}],password_confirm:[{validator:(e,a,l)=>{this.form.password&&a!==this.form.password?l(new Error("确认密码不一致")):l()},trigger:"blur"}],expire_time_text:[{validator:(e,a,l)=>{this.form.no_expire||a?l():l(new Error("请输入过期时间"))},required:!0,trigger:"blur"}]}}},props:["open_edit","curModel"],created(){this.dialogVisible=this.open_edit,this.form=this.curModel},methods:{addClick(){let a=this,l=this.form;a.$refs.form.validate((o=>{o&&(a.loading=!0,j.editShop(l,!0).then((l=>{a.loading=!1,e({message:"恭喜你，修改成功",type:"success"}),a.dialogFormVisible(!0)})).catch((e=>{a.loading=!1})))}))},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},E=V("div",{style:{height:"0",overflow:"hidden"}},[V("input",{type:"password"})],-1),z=V("p",{class:"gray"},"注：平台后台用户名",-1),L=V("p",{class:"gray"},"注：平台后台用户密码",-1),U={class:"dialog-footer"};const M=f(S,[["render",function(e,s,p,n,m,u){const c=a,h=l,f=o,g=t,x=r,v=i,D=d;return _(),b(D,{title:"编辑平台",modelValue:m.dialogVisible,"onUpdate:modelValue":s[7]||(s[7]=e=>m.dialogVisible=e),onClose:u.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:w((()=>[V("div",U,[y(v,{onClick:u.dialogFormVisible},{default:w((()=>[C("取 消")])),_:1},8,["onClick"]),y(v,{type:"primary",onClick:s[6]||(s[6]=e=>u.addClick()),loading:m.loading},{default:w((()=>[C("确 定")])),_:1},8,["loading"])])])),default:w((()=>[y(x,{size:"small",model:m.form,ref:"form",rules:m.rules},{default:w((()=>[E,y(h,{label:"平台名称","label-width":m.formLabelWidth,prop:"app_name"},{default:w((()=>[y(c,{modelValue:m.form.app_name,"onUpdate:modelValue":s[0]||(s[0]=e=>m.form.app_name=e),autocomplete:"off",placeholder:"请输入平台名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),y(h,{label:"过期时间","label-width":m.formLabelWidth,prop:"expire_time_text"},{default:w((()=>[y(f,{modelValue:m.form.expire_time_text,"onUpdate:modelValue":s[1]||(s[1]=e=>m.form.expire_time_text=e),type:"date",placeholder:"过期时间","value-format":"YYYY-MM-DD",disabled:m.form.no_expire},null,8,["modelValue","disabled"]),y(g,{modelValue:m.form.no_expire,"onUpdate:modelValue":s[2]||(s[2]=e=>m.form.no_expire=e),class:"pl16"},{default:w((()=>[C("永不过期")])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),y(h,{label:"平台账户名","label-width":m.formLabelWidth,prop:"user_name"},{default:w((()=>[y(c,{modelValue:m.form.user_name,"onUpdate:modelValue":s[3]||(s[3]=e=>m.form.user_name=e),autocomplete:"off",placeholder:"请输入平台账户名"},null,8,["modelValue"]),z])),_:1},8,["label-width"]),y(h,{label:"平台账户密码","label-width":m.formLabelWidth,prop:"password"},{default:w((()=>[y(c,{type:"password",modelValue:m.form.password,"onUpdate:modelValue":s[4]||(s[4]=e=>m.form.password=e),autocomplete:"off",placeholder:"请输入密码"},null,8,["modelValue"]),L])),_:1},8,["label-width"]),y(h,{label:"确认密码","label-width":m.formLabelWidth,prop:"password_confirm"},{default:w((()=>[y(c,{type:"password",modelValue:m.form.password_confirm,"onUpdate:modelValue":s[5]||(s[5]=e=>m.form.password_confirm=e),autocomplete:"off",placeholder:"请输入确认密码"},null,8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"])}]]),$={data(){return{form:{no_expire:!1,expire_time:0},formLabelWidth:"120px",dialogVisible:!1,loading:!1,rules:{app_name:[{validator:(e,a,l)=>a?this.$filter.isAllSpace(a)?l(new Error("不能全是空格")):void l():l(new Error("请输入平台名称")),required:!0,trigger:"blur"}],user_name:[{validator:(e,a,l)=>this.$filter.replaceSpace(a)?this.$filter.hasSpace(a)?l(new Error("不能包含空格")):void l():l(new Error("平台账户名")),required:!0,trigger:"blur"}],password:[{validator:(e,a,l)=>{if(a){if(this.$filter.hasSpace(a))return l(new Error("不能包含空格"));if(a.length<6)return l(new Error("长度不能小于6位"));l()}else l(new Error("请输入密码"))},required:!0,trigger:"change"}],password_confirm:[{validator:(e,a,l)=>{a?a!==this.form.password?l(new Error("确认密码不一致")):l():l(new Error("请填写确认密码"))},required:!0,trigger:"blur"}],expire_time:[{validator:(e,a,l)=>{this.form.no_expire||a?l():l(new Error("请输入过期时间"))},required:!0,trigger:"blur"}]}}},props:["open_add"],created(){this.dialogVisible=this.open_add},methods:{addClick(){let a=this,l=this.form;a.$refs.form.validate((o=>{o&&(a.loading=!0,j.addShop(l,!0).then((l=>{a.loading=!1,1==l.code&&(e({message:"恭喜你，添加成功",type:"success"}),a.dialogFormVisible(!0))})).catch((e=>{a.loading=!1})))}))},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},W=V("div",{style:{height:"0",overflow:"hidden"}},[V("input",{type:"password"})],-1),q=V("p",{class:"gray"},"注：平台后台用户名",-1),F=V("p",{class:"gray"},"注：平台后台用户密码",-1),Y={class:"dialog-footer"};const A={class:"common-level-rail"},P={class:"product-content"},N={class:"table-wrap"},T={class:"pagination"};const B=f({components:{Edit:M,Add:f($,[["render",function(e,s,p,n,m,u){const c=a,h=l,f=o,g=t,x=r,v=i,D=d;return _(),b(D,{title:"新增平台",modelValue:m.dialogVisible,"onUpdate:modelValue":s[7]||(s[7]=e=>m.dialogVisible=e),onClose:u.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:w((()=>[V("div",Y,[y(v,{onClick:u.dialogFormVisible},{default:w((()=>[C("取 消")])),_:1},8,["onClick"]),y(v,{type:"primary",onClick:s[6]||(s[6]=e=>u.addClick()),loading:m.loading},{default:w((()=>[C("确 定")])),_:1},8,["loading"])])])),default:w((()=>[y(x,{size:"small",model:m.form,ref:"form",rules:m.rules},{default:w((()=>[W,y(h,{label:"平台名称","label-width":m.formLabelWidth,prop:"app_name"},{default:w((()=>[y(c,{modelValue:m.form.app_name,"onUpdate:modelValue":s[0]||(s[0]=e=>m.form.app_name=e),autocomplete:"off",placeholder:"请输入平台名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),y(h,{label:"过期时间","label-width":m.formLabelWidth,prop:"expire_time"},{default:w((()=>[y(f,{modelValue:m.form.expire_time,"onUpdate:modelValue":s[1]||(s[1]=e=>m.form.expire_time=e),type:"date",placeholder:"过期时间","value-format":"YYYY-MM-DD",disabled:m.form.no_expire},null,8,["modelValue","disabled"]),y(g,{modelValue:m.form.no_expire,"onUpdate:modelValue":s[2]||(s[2]=e=>m.form.no_expire=e),class:"pl16"},{default:w((()=>[C("永不过期")])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),y(h,{label:"平台账户名","label-width":m.formLabelWidth,prop:"user_name"},{default:w((()=>[y(c,{modelValue:m.form.user_name,"onUpdate:modelValue":s[3]||(s[3]=e=>m.form.user_name=e),autocomplete:"off",placeholder:"请输入平台账户名"},null,8,["modelValue"]),q])),_:1},8,["label-width"]),y(h,{label:"平台账户密码","label-width":m.formLabelWidth,prop:"password"},{default:w((()=>[y(c,{type:"password",modelValue:m.form.password,"onUpdate:modelValue":s[4]||(s[4]=e=>m.form.password=e),autocomplete:"off",placeholder:"请输入密码"},null,8,["modelValue"]),F])),_:1},8,["label-width"]),y(h,{label:"确认密码","label-width":m.formLabelWidth,prop:"password_confirm"},{default:w((()=>[y(c,{type:"password",modelValue:m.form.password_confirm,"onUpdate:modelValue":s[5]||(s[5]=e=>m.form.password_confirm=e),autocomplete:"off",placeholder:"请输入确认密码"},null,8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"])}]])},data:()=>({loading:!0,tableData:[],pageSize:20,totalDataNumber:0,curPage:1,open_add:!1,open_edit:!1,curModel:{}}),created(){this.getData()},methods:{targetLinkAddress:()=>`https://${window.location.hostname}/shop/#/login`,handleCurrentChange(e){let a=this;a.curPage=e,a.loading=!0,a.getData()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getData()},getData(){let e=this;j.shopList({page:e.curPage,list_rows:e.pageSize},!0).then((a=>{e.loading=!1,e.tableData=a.data.list.data,e.totalDataNumber=a.data.list.total,e.tableData.forEach((function(e){e.is_recycle=1!==e.is_recycle}))})).catch((e=>{}))},addClick(){this.open_add=!0},editClick(e){this.open_edit=!0,this.curModel=g(e),0==this.curModel.expire_time?(this.curModel.expire_time_text="",this.curModel.no_expire=!0):this.curModel.no_expire=!1},closeDialogFunc(e,a){"add"==a&&(this.open_add=e.openDialog,"success"==e.type&&this.getData()),"edit"==a&&(this.open_edit=e.openDialog,"success"==e.type&&this.getData())},statusChange:function(e,a){let l=this;l.loading=!0,j.updateStatus({app_id:a.app_id},!0).then((o=>{l.loading=!1,a.is_recycle=e})).catch((o=>{l.loading=!1,a.is_recycle=!e}))},deleteClick(a){let l=this;s.confirm("删除后不可恢复，确认删除该记录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{l.loading=!0,j.deleteShop({app_id:a.app_id},!0).then((a=>{l.loading=!1,1==a.code&&(e({message:a.msg,type:"success"}),l.getTableList())})).catch((e=>{l.loading=!1}))})).catch((()=>{}))},storeEnter(e){j.storeEnter({app_id:e},!0).then((e=>{})).catch((e=>{}))}}},[["render",function(e,a,l,o,r,d){const s=i,h=u,f=t,g=c,j=p,S=k("Add"),E=k("Edit"),z=n,L=m;return x((_(),v("div",null,[V("div",A,[y(s,{type:"primary",onClick:d.addClick},{default:w((()=>[C("添加平台")])),_:1},8,["onClick"])]),V("div",P,[V("div",N,[x((_(),b(j,{size:"small",data:r.tableData,style:{width:"100%"},"row-key":"access_id",border:"","default-expand-all":""},{default:w((()=>[y(h,{prop:"app_id",label:"平台ID"}),y(h,{prop:"app_name",label:"平台名称"}),y(h,{prop:"user_name",label:"超管账号"}),y(h,{prop:"status",label:"状态"},{default:w((e=>[y(f,{modelValue:e.row.is_recycle,"onUpdate:modelValue":a=>e.row.is_recycle=a,onChange:a=>d.statusChange(a,e.row)},{default:w((()=>[C("启用 ")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),y(h,{prop:"expire_time_text",label:"过期时间"}),y(h,{prop:"create_time",label:"添加时间"}),y(h,{label:"操作",width:"150"},{default:w((e=>[y(g,{href:d.targetLinkAddress(),target:"_blank",type:"primary",size:"small"},{default:w((()=>[C("进入商城")])),_:1},8,["href"]),y(g,{class:"ml10",onClick:a=>d.editClick(e.row),type:"primary",size:"small"},{default:w((()=>[C("编辑")])),_:2},1032,["onClick"]),y(g,{class:"ml10",onClick:a=>d.deleteClick(e.row),type:"primary",size:"small"},{default:w((()=>[C("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[L,r.loading]])])]),r.open_add?(_(),b(S,{key:0,open_add:r.open_add,onCloseDialog:a[0]||(a[0]=e=>d.closeDialogFunc(e,"add"))},null,8,["open_add"])):D("",!0),r.open_edit?(_(),b(E,{key:1,open_edit:r.open_edit,curModel:r.curModel,onCloseDialog:a[1]||(a[1]=e=>d.closeDialogFunc(e,"edit"))},null,8,["open_edit","curModel"])):D("",!0),V("div",T,[y(z,{onSizeChange:d.handleSizeChange,onCurrentChange:d.handleCurrentChange,background:"","current-page":r.curPage,"page-size":r.pageSize,layout:"total, prev, pager, next, jumper",total:r.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])),[[L,r.loading]])}]]);export{B as default};
