import{f as e,b as l,c as a,r as o,s as i,a as s,d,j as t,m,l as r,k as n,v as p,e as u}from"./element-plus-d2381bb9.js";import{r as c}from"./request-9782e391.js";import{_ as f,d as g}from"./index-ea3b29b4.js";import{o as h,S as _,R as b,a as V,O as k,V as w,_ as y,c as C,X as v,ad as D}from"./@vue-5f6096d8.js";import"./@vueuse-40ae03aa.js";import"./lodash-es-493ac664.js";import"./async-validator-cf877c1f.js";import"./dayjs-03c8ce7e.js";import"./call-bind-224993cc.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-e5d54f4f.js";import"./escape-html-1935ddb3.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./axios-85bcd05e.js";import"./qs-bc70bccf.js";import"./side-channel-f1de7f2e.js";import"./object-inspect-02d150af.js";import"./vue-router-0438cf31.js";import"./pinia-a7eba4b6.js";import"./vue-demi-71ba0ef2.js";let L={messageList:(e,l)=>c._post("/admin/message/index",e,l),addMessage:(e,l)=>c._post("/admin/message/add",e,l),editMessage:(e,l)=>c._post("/admin/message/edit",e,l),deleteMessage:(e,l)=>c._post("/admin/message/delete",e,l),fieldList:(e,l)=>c._post("/admin/message/field",e,l),saveField:(e,l)=>c._post("/admin/message/saveField",e,l)};const j={class:"dialog-footer"};const F={class:"dialog-footer"};const U={class:"common-level-rail"},x={class:"table-wrap"},M={class:"dialog-footer"};const W={class:"product"},z={class:"common-level-rail"},$={class:"product-content"},T={class:"table-wrap"};const q=f({components:{Edit:f({data:()=>({categoryList:[],formLabelWidth:"120px",dialogVisible:!1,loading:!1}),props:["open_edit","form"],created(){this.dialogVisible=this.open_edit},methods:{editMessage(){let l=this,a=this.form;l.$refs.form.validate((o=>{o&&(l.loading=!0,L.editMessage(a,!0).then((a=>{l.loading=!1,e({message:"恭喜你，修改成功",type:"success"}),l.dialogFormVisible(!0)})).catch((e=>{l.loading=!1})))}))},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},[["render",function(e,m,r,n,p,u){const c=l,f=a,g=o,y=i,C=s,v=d,D=t;return h(),_(D,{title:"编辑消息",modelValue:p.dialogVisible,"onUpdate:modelValue":m[6]||(m[6]=e=>p.dialogVisible=e),onClose:u.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:b((()=>[V("div",j,[k(v,{onClick:u.dialogFormVisible},{default:b((()=>[w("取 消")])),_:1},8,["onClick"]),k(v,{type:"primary",onClick:u.editMessage,loading:p.loading},{default:b((()=>[w("确 定")])),_:1},8,["onClick","loading"])])])),default:b((()=>[k(C,{size:"small",model:r.form,ref:"form"},{default:b((()=>[k(f,{label:"消息名称","label-width":p.formLabelWidth,rules:[{required:!0,message:" "}],prop:"message_name"},{default:b((()=>[k(c,{modelValue:r.form.message_name,"onUpdate:modelValue":m[0]||(m[0]=e=>r.form.message_name=e),autocomplete:"off",placeholder:"请输入消息名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"名称(英文唯一)","label-width":p.formLabelWidth,rules:[{required:!0,message:" "}],prop:"message_ename"},{default:b((()=>[k(c,{modelValue:r.form.message_ename,"onUpdate:modelValue":m[1]||(m[1]=e=>r.form.message_ename=e),autocomplete:"off",placeholder:"请输入消息英文名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"通知对象","label-width":p.formLabelWidth},{default:b((()=>[k(y,{modelValue:r.form.message_to,"onUpdate:modelValue":m[2]||(m[2]=e=>r.form.message_to=e),placeholder:"请选择通知对象"},{default:b((()=>[k(g,{label:"会员",value:10}),k(g,{label:"商家",value:20}),k(g,{label:"供应商",value:30})])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"消息类别","label-width":p.formLabelWidth},{default:b((()=>[k(y,{modelValue:r.form.message_type,"onUpdate:modelValue":m[3]||(m[3]=e=>r.form.message_type=e),placeholder:"请选择消息类别"},{default:b((()=>[k(g,{label:"订单",value:10}),k(g,{label:"分销",value:20}),k(g,{label:"通知",value:30})])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"排序","label-width":p.formLabelWidth},{default:b((()=>[k(c,{modelValue:r.form.sort,"onUpdate:modelValue":m[4]||(m[4]=e=>r.form.sort=e),placeholder:"请输入数字"},null,8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"备注","label-width":p.formLabelWidth},{default:b((()=>[k(c,{modelValue:r.form.remark,"onUpdate:modelValue":m[5]||(m[5]=e=>r.form.remark=e),autocomplete:"off",placeholder:"请输入备注"},null,8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model"])])),_:1},8,["modelValue","onClose"])}]]),Add:f({data:()=>({form:{status:0,sort:100},categoryList:[],sort:"100",radio:"1",formLabelWidth:"120px",dialogVisible:!1,loading:!1}),props:["open_add"],created(){this.dialogVisible=this.open_add},methods:{addClick(){let l=this,a=this.form;l.$refs.form.validate((o=>{o&&(l.loading=!0,L.addMessage(a,!0).then((a=>{1==a.code?(l.loading=!1,e({message:"恭喜你，添加成功",type:"success"}),l.dialogFormVisible(!0)):l.loading=!1})).catch((e=>{})))}))},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},[["render",function(e,m,r,n,p,u){const c=l,f=a,g=o,y=i,C=s,v=d,D=t;return h(),_(D,{title:"添加消息",modelValue:p.dialogVisible,"onUpdate:modelValue":m[7]||(m[7]=e=>p.dialogVisible=e),onClose:u.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:b((()=>[V("div",F,[k(v,{onClick:u.dialogFormVisible},{default:b((()=>[w("取 消")])),_:1},8,["onClick"]),k(v,{type:"primary",onClick:m[6]||(m[6]=e=>u.addClick()),loading:p.loading},{default:b((()=>[w("确 定")])),_:1},8,["loading"])])])),default:b((()=>[k(C,{size:"small",model:p.form,ref:"form"},{default:b((()=>[k(f,{label:"消息名称","label-width":p.formLabelWidth,rules:[{required:!0,message:" "}],prop:"message_name"},{default:b((()=>[k(c,{modelValue:p.form.message_name,"onUpdate:modelValue":m[0]||(m[0]=e=>p.form.message_name=e),autocomplete:"off",placeholder:"请输入消息名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"名称(英文唯一)","label-width":p.formLabelWidth,rules:[{required:!0,message:" "}],prop:"message_ename"},{default:b((()=>[k(c,{modelValue:p.form.message_ename,"onUpdate:modelValue":m[1]||(m[1]=e=>p.form.message_ename=e),autocomplete:"off",placeholder:"请输入消息英文名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"通知对象","label-width":p.formLabelWidth},{default:b((()=>[k(y,{modelValue:p.form.message_to,"onUpdate:modelValue":m[2]||(m[2]=e=>p.form.message_to=e),placeholder:"请选择通知对象"},{default:b((()=>[k(g,{label:"会员",value:10}),k(g,{label:"商家",value:20}),k(g,{label:"供应商",value:30})])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"消息类别","label-width":p.formLabelWidth},{default:b((()=>[k(y,{modelValue:p.form.message_type,"onUpdate:modelValue":m[3]||(m[3]=e=>p.form.message_type=e),placeholder:"请选择消息类别"},{default:b((()=>[k(g,{label:"订单",value:10}),k(g,{label:"分销",value:20}),k(g,{label:"通知",value:30})])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"排序","label-width":p.formLabelWidth},{default:b((()=>[k(c,{modelValue:p.form.sort,"onUpdate:modelValue":m[4]||(m[4]=e=>p.form.sort=e),placeholder:"请输入数字"},null,8,["modelValue"])])),_:1},8,["label-width"]),k(f,{label:"备注","label-width":p.formLabelWidth},{default:b((()=>[k(c,{modelValue:p.form.remark,"onUpdate:modelValue":m[5]||(m[5]=e=>p.form.remark=e),autocomplete:"off",placeholder:"请输入备注"},null,8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model"])])),_:1},8,["modelValue","onClose"])}]]),Field:f({data:()=>({formLabelWidth:"120px",dialogVisible:!1,title:"字段管理",fieldData:[],deleteIds:[],loading:!0}),props:["open_field","form"],created(){this.dialogVisible=this.open_field,this.title=this.title+"("+this.form.message_name+")",this.getFieldList()},methods:{getFieldList:function(){let e=this;L.fieldList({message_id:e.form.message_id},!0).then((l=>{e.loading=!1,e.fieldData=l.data.list})).catch((l=>{e.loading=!1}))},saveField:function(){let l=this;L.saveField({message_id:l.form.message_id,fieldData:l.fieldData,deleteIds:l.deleteIds},!0).then((a=>{e({message:"恭喜你，修改成功",type:"success"}),l.dialogFormVisible(!0)})).catch((e=>{}))},addClick:function(){this.fieldData.push({message_field_id:0,message_id:this.form.message_id,field_name:"",field_ename:"",filed_value:"",sort:100})},deleteClick:function(e){let l=this.fieldData[e];l.message_field_id>0&&this.deleteIds.push(l.message_field_id),this.fieldData.splice(e,1)},checkRow:function(e,l){l.is_var=e?1:0},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},[["render",function(e,a,o,i,u,c){const f=d,g=l,C=m,v=r,D=n,L=s,j=t,F=p;return h(),_(j,{title:u.title,modelValue:u.dialogVisible,"onUpdate:modelValue":a[0]||(a[0]=e=>u.dialogVisible=e),onClose:c.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:b((()=>[V("div",M,[k(f,{onClick:c.dialogFormVisible},{default:b((()=>[w("取 消")])),_:1},8,["onClick"]),k(f,{type:"primary",onClick:c.saveField,loading:u.loading},{default:b((()=>[w("确 定")])),_:1},8,["onClick","loading"])])])),default:b((()=>[V("div",U,[k(f,{size:"small",link:"",type:"primary",onClick:c.addClick},{default:b((()=>[w("添加字段")])),_:1},8,["onClick"])]),k(L,{size:"small"},{default:b((()=>[V("div",x,[y((h(),_(D,{border:"",data:u.fieldData},{default:b((()=>[k(C,{label:"字段名称",width:"120px"},{default:b((e=>[k(g,{size:"small",prop:"field_name",modelValue:e.row.field_name,"onUpdate:modelValue":l=>e.row.field_name=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(C,{label:"字段英文名",width:"130px"},{default:b((e=>[k(g,{size:"small",prop:"field_ename",modelValue:e.row.field_ename,"onUpdate:modelValue":l=>e.row.field_ename=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(C,{label:"字段默认值"},{default:b((e=>[k(g,{size:"small",prop:"filed_value",modelValue:e.row.filed_value,"onUpdate:modelValue":l=>e.row.filed_value=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(C,{label:"是否变量",width:"70px"},{default:b((e=>[k(v,{prop:"is_var",checked:1===e.row.is_var,onChange:l=>c.checkRow(l,e.row)},null,8,["checked","onChange"])])),_:1}),k(C,{label:"排序",width:"70px"},{default:b((e=>[k(g,{size:"small",prop:"sort",modelValue:e.row.sort,"onUpdate:modelValue":l=>e.row.sort=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),k(C,{fixed:"right",label:"操作",width:"70px"},{default:b((e=>[k(f,{onClick:l=>c.deleteClick(e.$index),link:"",type:"primary",size:"small"},{default:b((()=>[w("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[F,u.loading]])])])),_:1})])),_:1},8,["title","modelValue","onClose"])}]])},data:()=>({loading:!0,activeIndex:"0",formInline:{user:"",region:""},tableData:[],totalDataNumber:0,categoryList:[],open_add:!1,open_edit:!1,messageModel:{},open_field:!1}),created(){this.getTableList()},methods:{getTableList(){let e=this;L.messageList({},!0).then((l=>{e.loading=!1,e.tableData=l.data.list,e.totalDataNumber=l.data.list.total})).catch((l=>{e.loading=!1}))},addClick(){this.open_add=!0},editClick(e){this.messageModel=g(e),this.messageModel.message_to=this.messageModel.message_to.value,this.messageModel.message_type=this.messageModel.message_type.value,this.open_edit=!0},fieldClick(e){this.messageModel=e,this.open_field=!0},closeDialogFunc(e,l){"add"==l&&(this.open_add=e.openDialog,"success"==e.type&&this.getTableList()),"edit"==l&&(this.open_edit=e.openDialog,"success"==e.type&&this.getTableList()),"field"==l&&(this.open_field=e.openDialog,"success"==e.type&&this.getTableList())},deleteClick(l){let a=this;u.confirm("删除后不可恢复，确认删除该记录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{a.loading=!0,L.deleteMessage({message_id:l.message_id},!0).then((l=>{a.loading=!1,e({message:l.msg,type:"success"}),a.getTableList()})).catch((e=>{a.loading=!1}))})).catch((()=>{}))}}},[["render",function(e,l,a,o,i,s){const t=d,r=m,u=n,c=D("Add"),f=D("Edit"),g=D("Field"),L=p;return h(),C("div",W,[V("div",z,[k(t,{type:"primary",onClick:s.addClick},{default:b((()=>[w("添加消息")])),_:1},8,["onClick"])]),V("div",$,[V("div",T,[y((h(),_(u,{size:"small",data:i.tableData,border:"","default-expand-all":"","tree-props":{children:"children"},"row-key":"plus_id"},{default:b((()=>[k(r,{prop:"message_name",label:"消息名称"}),k(r,{prop:"message_ename",label:"消息名称(英文)"}),k(r,{prop:"message_to.text",label:"通知对象"}),k(r,{prop:"message_type.text",label:"消息类型"}),k(r,{label:"字段"},{default:b((e=>[k(t,{onClick:l=>s.fieldClick(e.row),link:"",type:"primary",size:"small"},{default:b((()=>[w("字段管理")])),_:2},1032,["onClick"])])),_:1}),k(r,{prop:"remark",label:"消息描述"}),k(r,{prop:"sort",label:"排序"}),k(r,{prop:"create_time",label:"添加时间"}),k(r,{fixed:"right",label:"操作"},{default:b((e=>[k(t,{onClick:l=>s.editClick(e.row),link:"",type:"primary",size:"small"},{default:b((()=>[w("编辑")])),_:2},1032,["onClick"]),k(t,{onClick:l=>s.deleteClick(e.row),link:"",type:"primary",size:"small"},{default:b((()=>[w("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[L,i.loading]])])]),i.open_add?(h(),_(c,{key:0,open_add:i.open_add,onCloseDialog:l[0]||(l[0]=e=>s.closeDialogFunc(e,"add"))},null,8,["open_add"])):v("",!0),i.open_edit?(h(),_(f,{key:1,open_edit:i.open_edit,form:i.messageModel,onCloseDialog:l[1]||(l[1]=e=>s.closeDialogFunc(e,"edit"))},null,8,["open_edit","form"])):v("",!0),i.open_field?(h(),_(g,{key:2,open_field:i.open_field,form:i.messageModel,onCloseDialog:l[2]||(l[2]=e=>s.closeDialogFunc(e,"field"))},null,8,["open_field","form"])):v("",!0)])}]]);export{q as default};
