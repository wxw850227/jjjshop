System.register(["./element-plus-legacy-9a8d946d.js","./index-legacy-b686ba8a.js","./@vue-legacy-74f2101e.js"],(function(e,t){"use strict";var i,n,l,a,s,o,d,u,r,c,f,g,m,_,p,h,v,b,w;return{setters:[function(e){i=e.E,n=e.c,l=e.d,a=e.k,s=e.h,o=e.b,d=e.e,u=e.p,r=e.v},function(e){c=e.r,f=e._},function(e){g=e.o,m=e.T,_=e.S,p=e.a,h=e.P,v=e.W,b=e.X,w=e.$}],execute:function(){var t=e("M",{messageList:function(e,t){return c._post("/shop/setting.message/index",e,t)},fieldList:function(e,t){return c._post("/shop/setting.message/field",e,t)},saveSettings:function(e,t){return c._post("/shop/setting.message/saveSettings",e,t)},updateSettingsStatus:function(e,t){return c._post("/shop/setting.message/updateSettingsStatus",e,t)}}),V={data:function(){return{formLabelWidth:"120px",dialogVisible:!1,loading:!1,isupload:!1,fieldList:[],title:"设置小程序消息订阅模板",checkList:[],settings:{},template_id:"",msg:"3、变量填写、例如{{thing4.DATA}}，只需要填写thing4。"}},props:["open_wx","messageModel"],created:function(){this.dialogVisible=this.open_wx,this.title=this.title+"("+this.messageModel.message_name+")",this.getData()},methods:{getData:function(){var e=this;e.loading=!0,t.fieldList({message_id:e.messageModel.message_id,message_type:"wx"},!0).then((function(t){t.data.list.forEach((function(e){e.field_new_ename=e.field_ename,e.filed_new_value=e.filed_value})),e.fieldList=t.data.list,null==t.data.settings||0==t.data.settings.length?(e.settings={},e.template_id=""):(e.settings=t.data.settings,e.template_id=t.data.settings.template_id),e.loading=!1,e.$nextTick((function(){e.initChecked()}))})).catch((function(e){}))},saveTemplate:function(){var e=this;e.loading=!0,t.saveSettings({fieldList:e.checkList,message_id:e.messageModel.message_id,message_type:"wx",template_id:e.template_id}).then((function(t){e.loading=!1,i({message:"保存成功",type:"success"}),e.dialogFormVisible(!0)})).catch((function(t){e.loading=!1}))},dialogFormVisible:function(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})},handleSelectionChange:function(e){this.checkList=e},initChecked:function(){var e=this;"{}"!=JSON.stringify(e.settings)&&Object.keys(e.settings.var_data).forEach((function(t){e.fieldList.forEach((function(i){i.field_ename==t&&(e.$refs.fieldTable.toggleRowSelection(i,!0),i.field_new_ename=e.settings.var_data[t].field_name,i.filed_new_value=e.settings.var_data[t].filed_value)}))}))}}},S={class:"table-wrap"},y={class:"operation-wrap"},C=p("p",null," 配置说明：",-1),k=p("p",null," 1、微信小程序订阅模板里有的字段才勾选，如果没有请勿勾选。",-1),x=p("p",null," 2、模板变量替换成微信小程序订阅模板里的字段。",-1),L=["textContent"],T={class:"dialog-footer"},D=e("W",f(V,[["render",function(e,t,i,c,f,V){var D=n,j=l,M=a,U=s,z=o,$=d,E=u,F=r;return g(),m(E,{title:f.title,modelValue:f.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=function(e){return f.dialogVisible=e}),onClose:V.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:_((function(){return[p("div",T,[h($,{onClick:V.dialogFormVisible},{default:_((function(){return[v("取 消")]})),_:1},8,["onClick"]),h($,{type:"primary",onClick:V.saveTemplate,loading:f.loading},{default:_((function(){return[v("确 定")]})),_:1},8,["onClick","loading"])])]})),default:_((function(){return[h(z,{size:"small"},{default:_((function(){return[p("div",S,[p("div",y,[C,k,x,p("p",null,b(f.msg),1)]),p("div",null,[h(j,{label:"模板id："},{default:_((function(){return[h(D,{size:"small",class:"max-w460",modelValue:f.template_id,"onUpdate:modelValue":t[0]||(t[0]=function(e){return f.template_id=e}),placeholder:"请填写申请的微信小程序订阅模板消息idid"},null,8,["modelValue"])]})),_:1})]),w((g(),m(U,{border:"",ref:"fieldTable",data:f.fieldList,onSelectionChange:V.handleSelectionChange},{default:_((function(){return[h(M,{type:"selection",width:"55"}),h(M,{label:"字段名称"},{default:_((function(e){return[p("label",{textContent:b(e.row.field_name)},null,8,L)]})),_:1}),h(M,{label:"模板变量名"},{default:_((function(e){return[h(D,{size:"small",prop:"field_new_ename",modelValue:e.row.field_new_ename,"onUpdate:modelValue":function(t){return e.row.field_new_ename=t}},null,8,["modelValue","onUpdate:modelValue"])]})),_:1}),h(M,{label:"模板内容"},{default:_((function(e){return[h(D,{size:"small",prop:"filed_new_value",disabled:1===e.row.is_var,modelValue:e.row.filed_new_value,"onUpdate:modelValue":function(t){return e.row.filed_new_value=t}},null,8,["disabled","modelValue","onUpdate:modelValue"])]})),_:1})]})),_:1},8,["data","onSelectionChange"])),[[F,f.loading]])])]})),_:1})]})),_:1},8,["title","modelValue","onClose"])}]])),j=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}));e("a",j)}}}));
